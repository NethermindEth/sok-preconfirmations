% \documentclass[conference]{IEEEtran}
%temp
\documentclass[a4paper]{article} 
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts,amsthm}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage[dvipsnames]{xcolor}
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage[most]{tcolorbox}
\usepackage{hyperref}
%temp package
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[margin=1in]{geometry}

% Formatting for links
% \hypersetup{
%     colorlinks=true,
%     citecolor=Blue, 
%     linkcolor=Maroon,
%     urlcolor=NavyBlue
% }

\newtheoremstyle{boldstyle}% name
  {\topsep}% space above
  {\topsep}% space below
  {\itshape}% body font
  { }% indent
  {\bfseries}% head font (bold!)
  {.}% punctuation after head
  { }% space after head
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}% head spec
\theoremstyle{boldstyle}
% \newtheorem{openquestionx}{Open Question}[section]
% \renewcommand{\theopenquestionx}{\thesection.Q\arabic{openquestionx}}
\newtheorem{openquestionx}{Open Question}
\renewcommand{\theopenquestionx}{Q\arabic{openquestionx}}
\newmdenv[
  skipabove=2pt,
  skipbelow=2pt,
  linewidth=1pt,
  linecolor=blue,
  backgroundcolor=blue!5,
  roundcorner=5pt,
  innertopmargin=2pt,
  innerbottommargin=2pt,
  innerleftmargin=3pt,
  innerrightmargin=3pt
]{openboxq}
\newenvironment{openquestion}
  {\begin{openboxq}\begin{openquestionx}}
  {\end{openquestionx}\end{openboxq}}

% Definition box formatting
\newtheorem{definitionx}{Definition} 
\newmdenv[
  skipabove=2pt,
  skipbelow=2pt,
  linewidth=1pt,
  linecolor=orange,
  backgroundcolor=orange!5,
  roundcorner=5pt,
  innertopmargin=2pt,
  innerbottommargin=2pt,
  innerleftmargin=3pt,
  innerrightmargin=3pt
]{defopenboxq}

\newenvironment{definition}
  {\begin{defopenboxq}\begin{definitionx}}
  {\end{definitionx}\end{defopenboxq}}
%%%%%%% 

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

% Caveat box formatting 
\newlength{\entrysep}
\setlength{\entrysep}{8pt}
%\par\vspace{\entrysep}

\newtcolorbox{riskbox}[1]{
                colback=black!6,
                colframe=black!35,
                colbacktitle=red!20,
                coltitle=black,
                fonttitle=\bfseries,
                title=#1,
                sharp corners,
                boxrule=0.2mm,
                boxsep=5pt,
                top=2pt,
                bottom=2pt,
                left=2pt,
                right=2pt
            }

\newtcolorbox{considerationbox}[1]{
                colback=black!6,
                colframe=black!35,
                colbacktitle=blue!20,
                coltitle=black,
                fonttitle=\bfseries,
                title=#1,
                sharp corners,
                boxrule=0.2mm,
                boxsep=5pt,
                top=2pt,
                bottom=2pt,
                left=2pt,
                right=2pt
            }

% \newtcolorbox{caveatbox}[1]{
%                 colback=black!5,
%                 colframe=black!75,
%                 fonttitle=\bfseries,
%                 title=#1,
%                 sharp corners,
%                 boxsep=5pt,
%                 top=2pt,
%                 bottom=2pt,
%                 left=2pt,
%                 right=2pt
%             }
        \newcommand{\risk}[1]{\par\noindent\textbf{\textcolor{black}{Risk:}} #1\par\vspace{\entrysep}}
        \newcommand{\consideration}[1]{\par\noindent\textbf{\textcolor{black}{Consideration:}} #1\par\vspace{\entrysep}}
        \newcommand{\mitigation}[1]{\par\noindent\textbf{\textcolor{black}{Mitigation:}} #1}
%%%%%%%

% comment management code
\newcommand{\cm}[1]{\textcolor{blue}{\textbf{Conor:} #1}}
\newcommand{\qb}[1]{\textcolor{red}{\textbf{Quentin:} #1}}
\newcommand{\lo}[1]{\textcolor{orange}{\textbf{Lin:} #1}}
\newcommand{\dk}[1]{\textcolor{cyan}{\textbf{Demetris:} #1}}
\newcommand{\open}[1]{\textcolor{green}{\textbf{open:} #1}}
\newcommand{\ks}[1]{\textcolor{purple}{\textbf{Katerina:} #1}}

\newcommand{\todocm}[1]{\todo[color=blue!40]{\textbf{Conor:} #1}}
\newcommand{\todoqb}[1]{\todo[color=red!40]{\textbf{Quentin:} #1}}
\newcommand{\todolo}[1]{\todo[color=orange!40]{\textbf{Lin:} #1}}
\newcommand{\tododk}[1]{\todo[color=cyan!40]{\textbf{Demetris:} #1}}
%%%%%%% 



\begin{document}

\title{SoK: Preconfirmations} 

\author{\IEEEauthorblockN{1\textsuperscript{st} Given Name Surname}
\IEEEauthorblockA{\textit{dept. name of organization (of Aff.)} \\
\textit{name of organization (of Aff.)}\\
City, Country \\
email address or ORCID}
\and
\IEEEauthorblockN{2\textsuperscript{nd} Given Name Surname}
\IEEEauthorblockA{\textit{dept. name of organization (of Aff.)} \\
\textit{name of organization (of Aff.)}\\
City, Country \\
email address or ORCID}
\and
\IEEEauthorblockN{3\textsuperscript{rd} Given Name Surname}
\IEEEauthorblockA{\textit{dept. name of organization (of Aff.)} \\
\textit{name of organization (of Aff.)}\\
City, Country \\
email address or ORCID}
}

% \maketitle

% \begin{abstract}
% This document is a model and instructions for \LaTeX.
% \end{abstract}

% \begin{IEEEkeywords}
% component, formatting, style, styling, insert
% \end{IEEEkeywords}


%temp 
\setlength{\marginparwidth}{2cm} 
\listoftodos
% https://www.overleaf.com/latex/examples/example-of-inline-and-margin-comments/rrccpcvhrtwr

\section{Introduction}
\todo{coherency in american/british english}
\todo{rewrite intro}

% Since the early days of blockchains, it has been well known that by design the system can handle only a limited number of transactions (txs) per second. Meanwhile, traditional centralised payment systems can seamlessly cope with thousands of transactions per second in a quick and efficient way. This scalability issue could seriously impede wide adoption and it was a necessity to solve it to improve Web3 user's experience (UX).

% \cm{Going into L2s in a 2nd paragraph before introducing preconfs is probably too confusing.}
% Layer 2s were introduced as a solution to blockchain's scalability trilemma. First formalised by Vitalik Buterin, blockchain's scalability trilemma states that no blockchain system can be decentralised, scalable and secure. The main concept of a layer 2 is to offload transaction volume from its underlying layer 1 blockchain and provide increased throughput with lower transaction fees. \textit{Rollups} are a prime example of a layer 2 solution. Rollup transactions are executed on a separate layer 2 blockchain and aggregated or "rolled-up" in batches that are then recorded on layer 1 as single transactions. Thus, rollups achieve scalability by maintaining the security of layer 1.

% Moreover, the transition from Proof of Work (PoW) to Proof of Stake (PoS) in 2022 revolutionised Ethereum and opened up new possibilities. Transaction finality became explicit, block-production rate stabilised, and the whole consensus system became more predictable. Miners were replaced by validators, and time, which was perceived as an abstract concept in the PoW era, was now quantised in epochs divided to 32 slots of 12 seconds \lo{what do we mean by time as "abstract concept" in PoW? And is it important in context of preconfs?} \dk{For PoW, real time outside the chain has no meaning onchain. The Difficulty Adjustment mechanism aims to keep block-production rate to a block every 10 mins (on average) but interblock times are random and follow a Poisson distribution. PoS works like a normal clock and there's a new slot every exactly 12seconds. I only used it as a motive to introduce the concept of slots and epochs because it is related to my PhD research and I am quite familiar with it, but it does not necessarily need to be included.}. In each slot, one of the validators earns the right to act as a \textit{proposer} and build a new block for the chain. The list of upcoming proposers for the current epoch, is called \textit{lookahead} and is known in advance. Layer 2s have their own \textit{L2 proposer} or \textit{L2 sequencer} who is an entity that batches L2 transactions into L2 blocks and then submits them to the L2 smart contract deployed on L1\cite{W:AnatomyofaSlot:Thetumultuous12secondsduringEthereumslots}. \lo{Flow is confusing, we talk about the lookahead, then talk about the L2 sequencer who usually are centralized and not related to lookahead.} 

% Furthermore, the idea that block builders can extract value and increase their profit by reordering the transactions they include in a block was becoming more and more prominent. 
%Although the idea of Maximum Extractable Value (MEV) was originally cultivated for PoW, PoS's predetermined slot time and proposer lookahead provided fertile ground for it to flourish \lo{is it really fair to say PoS accelerated MEV? PoW already had mev-boost. Also, why are we introducing MEV here, doesn't seem important for introducing preconfs?}\dk{Well, MEV became much bigger with PBS which was developed for PoS. We should probably move PBS and MEV in the preliminaries section though}. 
% Gradually, MEV extraction became very sophisticated and led to Proposer-Builder Separation (PBS). \cm{why is PBS being introduced here?} In a PBS setting, proposers outsource the duty of building blocks to specialised entities called builders. Flashbots' MEV-Boost became the most predominant implementation of PBS and is so popular at the moment that 90\% of Ethereum blocks are created with it.

% However, despite layer 2 creation and PoS's transaction finality explicitness, the barrier of 12 second delay for transaction confirmation persisted. 
% \cm{first mention of preconfs, this is too late.}
% Therefore, \textit{preconfirmations} were proposed as a way to provide users with an early guarantee that their transaction will be included or executed on-chain, giving them a sense of "soft finality".

% Although the idea of preconfirming transactions is believed to have originated from earlier Bitcoin projects \lo{source?}\dk{\cite{W:Preconfirmations:Explained}}, the stimulus for preconfirmations was an article called "Based Preconfirmations" by Ethereum Foundation's researcher Justin Drake released in 2023~\cite{W:Basedpreconfirmations} \lo{preconfs existed before "based" through centralized sequencers. we need to think about how we mention centralized sequencers.}. Ever since, various early implementations, interesting theoretical designs, and conflicting opinions have arisen but they remain scattered and unstructured. 

This document systematizes knowledge of preconfirmations in a single resource and provides a common language. Our goal is to create a comprehensive and objective report that can be used as an entry point for beginners and a reference point for experts in the field. Finally, we conclude this paper with a list of open challenges to encourage future research on preconfirmations.


\section{Related Work}

\cm{this doesn't really connect what was done to what we are doing. We need to explain that these early resources/collections are early, not comprehensive and not useful as a systemization.}
This research project builds on previous work conducted in an early effort to aggregate and organise preconfirmation knowledge. Most notably, \cite{W:PreconfirmationsGlossaryRequirements} presents a glossary for terms related to preconfirmations  and \cite{W:AwesomeBasedPreconfirmations} puts together a collection of resources and articles about preconfirmations.

% \todoqb{rewrite following}
% We begin in Section~\ref{sec:txs} by defining core blockchain and distributed system concepts. Following this, Section~\ref{sec:L1_consensus} describes how Ethereum L1 reaches consensus among distributed network participants on the state of the ledger. Proceeding, Section~\ref{sec:L1_pipeline} outlines the L1 block-building pipeline. Section~\ref{sec:intro_mev} describes Maximal Extractable Value (MEV), which plays an important role in the motivation for preconfirmations, while also standing as a barrier to their implementation. Finally, Section~\ref{sec:intro_pbs} describes Proposer-Builder Separation, an architectural solution to address MEV among other things, which is tightly intertwined with the L1 block-building pipeline and the preconfirmation solutions that are emerging.

\section{Background} 
\label{sec:background}
This section outlines the established blockchain concepts necessary to understand preconfirmations. Although preconfirmations are blockchain-agnostic, in this article, we restrict our discussion to preconfirmations on Ethereum.

    \subsection{Blockchain Fundamentals}
    \label{subsec:BlockchainFundamentals}
    For the purpose of this document, we consider a blockchain as both the protocol and data structure used to derive a replicated state machine among a set of distributed, potentially distrusting, peers/nodes. Although the blockchain protocol defines rules %and a data structure
    intended to produce a single shared state for observers who follow the blockchain protocol, conflicting states can still emerge temporarily. Consensus mechanisms are used to resolve these conflicts and determine the single shared state of the system. In this document, we assume blockchains derive a single shared state. Furthermore, we focus on transaction-based blockchains which form the majority of blockchains today. These blockchains advance the shared state by sequentially executing an ordered list of transactions organized in a block. Every block links to the previous block. The canonical list of transactions that derive the single shared state is denoted as the blockchain ledger. \textbf{Inclusion} is the process of adding a transaction to the ordered list of transactions, and \textbf{execution} is the computation of a transaction's result, thereby updating the shared state. This distinction is critical for delineating the types of preconfirmations that can be given. 
    
    %As the archetypal implementation of a transaction-based state machine, we focus on Ethereum.
    \ks{ Conor I rephrased the following paragraph} One major category of transaction-based blockchains is Proof of Stake (PoS) blockchains. In PoS blockchains, the ledger is extended by entities known as validators, who hold a stake -- that is, they possess the blockchain’s native currency. These validators are typically selected to extend the ledger with a probability proportional to the size of their stake. As already mentioned, in this document, we focus on Ethereum that belongs to this category. In Ethereum, validators need to lock a minimum amount of the native currency, called Ether (ETH), to be able to participate in extending the blockchain ledger. \qb{Ethereum already introduced as a PoS blockchain; why phrase this sentence as if it's unique here that they must lock collateral? It sounds repetitive IMO. Also, "to participate", in what? the network, sending txs... etc. It's not clear here we mean consensus. Also, why native cryptocurrency then native currency?} \ks{Addressed} This locked amount is referred to as \textbf{collateral} or deposit. In addition to proposing new blocks, validators also attest to (vote on) the blocks proposed by others. Validators attesting to or proposing a block receive some rewards minted by the system. In addition, they can earn rewards through the tips of the transactions they include in the block they propose. These tips are known as transaction fees. If validators behave maliciously in verifiable ways specified by the rules of the protocol, they get penalized by losing a portion of their collateral -- a process known as \textbf{slashing}. 
    
    Ethereum is a smart-contract enabled blockchain. Smart contracts can be considered as a collection of code/functions, data, and state within the global state of a blockchain~\cite{W:IntroductionToSmartContracts} that enable applications to be built on and trustlessly executed by transactions on the underlying blockchain. At a high level, a smart contract consists of an algorithm and public data, both of which are created and updated through transactions originated by users and executed by validators. In the context of preconfirmations, smart contracts serve as critical components for coordinating and enforcing preconfirmations.
   
 
    \subsection{Ethereum's Block-Building Pipeline}
    \label{sec:L1_pipeline}
 \ks{ Conor I moved the following paragraph from above here; if we have time a diagram here to explain the basics of the pipeline could be added} In \hyperref[sec:L1_pipeline]{Section~\ref{sec:L1_pipeline}}, we highlight the key components of the Ethereum blockchain that are critical for understanding preconfirmations. In more detail, we describe the process through which blocks are built and eventually proposed, known as the block-building pipeline. 
    
    \paragraph{Transaction Propagation and Mempools}
        Users create transactions through their digital wallet(s) applications. These transactions are then sent to nodes, which maintain transaction mempools and expose standardized interfaces called Remote Procedure Call (RPC) endpoints. The nodes perform basic validation checks on each transaction (e.g., verifying the sender’s balance) before adding it to their mempool and potentially propagating it across the peer-to-peer (P2P) network. Nodes that do not propagate certain transactions are said to retain a private mempool. Validators select transactions from the mempool to construct an ordered list of transactions for inclusion in their blocks. Even if a transaction passes the initial validation checks before entering the mempool, it may still become invalid during execution if, for example, a prior transaction in the mempool drains the sender’s balance.  
        
    \paragraph{Proposers and Attesters: Selection and Responsibilities}
\ks{ Conor, after suggestion made by Quentin, I merged proposers and attesters paragraph adding the following sentence between them ``As already mentioned, validators not only propose blocks, but also vote on blocks."} progresses in epochs each consisting of 32 slots of $12$ seconds. During every slot, there is one eligible validator for constructing, signing, and proposing a block. This validator, known as proposer, is pseudo-randomly selected from the set of nodes that have deposited the minimum required amount of Ether and registered as validators. Beyond the rewards earned by following the Ethereum protocol (cf. Section \ref{subsec:BlockchainFundamentals}), the proposer can extract additional value -- known as maximal extractable value (MEV)~\cite{W:MaximalExtractableValueMEV} -- by intentionally manipulating the list of transactions proposed within the slot. For example, the proposer can include their own transactions to frontrun (i.e., place before) and/or backrun (place after) other transactions interacting with smart contracts that facilitate cryptocurrency exchanges~\cite{W:MaximalExtractableValueMEV}.

\ks{ Conor I have rewritten the following paragraph to accommodate your comments } 
The task of constructing the block can be unbundled from signing and proposing it. This is known as Proposer-Builder Separation (PBS) \cite{W:Proposer-builderseparation}. PBS enables proposers to delegate the construction of their block to specialized external entities known as builders. %In Ethereum, proposers can delegate the construction of their blocks -- and thus the extraction of MEV -- to specialized external entities known as builders (cf. Proposer-Builder Separation, PBS~\cite{W:Proposer-builderseparation}). 
In this case, proposers select the transaction list, referred to as the \texttt{ExecutionPayload} (cf. \cite{W:TheMerge--TheBeaconChain}), by running an auction in which builders compete by offering tips to the proposer. Note that when the proposer selects a transaction list, they can only see a commitment to it—not the entire list. The complete list is revealed by the builder only after the proposer has made their selection. MEV-Boost \cite{MEV-Boost}, an out-of-protocol implementation of PBS on Ethereum, is the primary source of blocks on Ethereum with over 90\% of blocks being sourced through MEV-Boost at the time of writing \cite{MEV.pics}.  \par

As already mentioned, validators not only propose blocks, but also vote on blocks. In more detail, for every slot, a committee known as the attestation committee is pseudorandomly selected from the validator set. This committee votes on the block they consider valid for that slot. A two-thirds threshold is applied in the rules that determine the single shared state in Ethereum (cf. Gasper~\cite{P:combiningghostcasper}). The specifics of this rule are not important for the purposes of this document. \qb{on its own this para feels out of place. I would perhaps make it part of the preceding responsibilities of validators (since in any case you described the proposer role in the language of validators, not proposers). Alternatively, justify as you have done with the lookahead why this paragraph is relevant for the discussion} \ks{Good point; I have merged them in the same paragraph and I added this sentence ``As already mentioned, validators not only propose blocks, but also vote on blocks."} \par 
    \paragraph{Proposer Lookahead}
        The proposer lookahead specified by the Ethereum protocol provides advance notice to validators of their proposing duties.
        According to EIP-7917 \cite{EIP7917} which is a candidate for inclusion in Ethereum’s upcoming update \ks{Conor I changed hard fork to update, better?}, the proposer schedule for epoch~$N+1$ becomes known and accessible -- e.g., via smart contracts -- at the start of epoch~$N$. %As we elaborate in \hyperref[sec:step2_lookahead]{Section~\ref{sec:step2_lookahead}},
        This lookahead is critical for enabling preconfirmations, as it allows future proposers to begin offering them before their assigned slot arrives. \\
    

    \qb{generally we need to see if one could better weave in the attesters/lookahead/state root paras since they no longer logically align with the actual chronology of the pipeline title} \ks{I merged attesters with proposers and I removed state root,because as we discussed in teh call we do not need it.}
    
\ks{ I removed the paragraph \textit{State Progression and Finalization} because it does not match Gasper (the original text is in iffalse command; a block needs to be justified before be finalised. Also, as we have assumed that there is a single shared state, the specifics of this rule are not important for this document. Instead, I have added a paragraph with title Attesters above}
\iffalse
``\textit{State Progression and Finalization}  \\
        In each slot, the proposer builds and proposes a block. An \textbf{attestation committee} is constructed from a random subset of validators and assigned to a slot. \textbf{Attestors} attest to the validity of the block, adding it to the blockchain. Attesting to a block also attests to all blocks on which that block is built. Due to latencies between validators and occasional validator faults, blocks are not considered \textbf{finalized}, or unable to be reverted~\cite{ETH2_book}, until they have received attestations from at least two-thirds of the validator set. As all of the validator set is assigned to a committee at least once per epoch, one epoch stands as the approximate finalization time for a block on Ethereum." 
\fi
\subsection{Ethereum Scaling Solutions}\label{sec:intro_L2}
\ks{Conor I changed the title to address your comment }
To enable a decentralized network to keep up with and reach consensus on state updates in blockchains, throughput is more limited compared to centralized solutions where a single trusted party maintains and updates transaction records. To increase throughput while still preserving key features of the blockchain (e.g. decentralization), scaling solutions in the form of additional layers have emerged. The original blockchain, in our case Ethereum, will be denoted by layer 1 (L1), and its canonical list of blocks with transactions by \textbf{L1 blockchain ledger}. The other layers will be called layer 2 (L2s), L3s, or generally LNs for some $N>1$. These LNs are execution environments that typically move one or more of the L(N-1) resources outside of the critical path of L(N-1) state progression. At the time of writing, the majority of LN users exist at L2, so without loss of generality, we will refer to L2s when discussing L1 scaling solutions.  \par
Deploying an execution environment as an L2 instead of L1 removes the need for the L2 to establish its own consensus protocol or dedicated economic security for securing state transitions (although these features can be added). L2s can tap into the user base of the L1, allowing L1 users to opt-in to locking their funds and using them within the L2. Many L2 solutions exist, including rollups, validiums, and Plasmas \qb{any particular reason why Plasma is capitalized?} \ks{It is also capital in the following reference and in here \url{https://vitalik.eth.limo/general/2023/11/14/neoplasma.html}}\cite{L2_versus_execution_sharding}. 
As in L1, L2 state progresses through proposers proposing blocks, establishing a canonical list of blocks with transactions, and some eventual finalization of L2 state implied by these blocks on the L1. The canonical list of transactions that derive the L2 state is denoted by \textbf{L2 blockchain ledger}. L2 solutions may differ in how they finalize L2 state or in the type of data they post to L1. However, these details are beyond the scope of this document. With respect to preconfirmations, two key L2-specific concepts are relevant:
\begin{enumerate}
    \item \textbf{L2 proposer selection:} A key factor impacting preconfs is whether an L2 is based or non-based.
    \begin{enumerate}
        \item \textbf{Based L2:} Delegates block proposing to the proposers of L1 ~\cite{W:ExaminingtheBasedSequencingSpectrum,W:BasedrollupssuperpowersfromL1sequencing}. 
        \item \textbf{Non-based L2:} Uses a dedicated proposer election mechanism. Within this category of non-based L2s, a key differentiating factor is whether there is one or many proposers. When there is only one proposer, preconfirmations are greatly simplified, at the cost of centralization, and the negative effects that this brings (e.g. single point of failure, monopolization). These single proposer non-based L2s are, rather appropriately, sometimes referred to as centralized sequencer L2s.  Some examples of centralized sequencer L2s include ..., while non-based L2s with multiple proposers include .... \ks{ Dimitris i needed to edit this after Conor's suggestion. Could you please add here some examples for centralized sequencer L2s  and non-based L2s with more than one proposers? } \cite{Optimism, Arbitrum, ZKsync, Starknet}. % an internal proposer election mechanism. In this type of L2s, another important factor that affects preconfirmations is whether there is a single proposer per block. These types of L2s are sometimes referred to as centralized sequencer L2s. \ks{I added the last sentence because we need it for section 4.1. Lin is it fine?} 
    \end{enumerate}
    \item \textbf{L2 governance:} \ks{we need to update this to discuss about on chain and off chain governance} L2s are semi-independent ecosystems that can utilize standalone governance for L2-specific upgrades and maintenance. L2 governance describes both the protocol and a set of L2 stakeholders who have special permissions to modify some or all of an L2's protocol specification. To the best of our knowledge, most L2s in production have some form of dedicated governance set~\cite{W:ComparativeAnalysisofOptimismandOtherLayer2GovernanceMechanisms}, although exceptions without governance set are possible~\cite{W:NativeRollups-SuperpowersfromL1execution}. \ks{Dimitris I could not find that the L2 mentioned in the last reference has not governance; is there a better reference for L2 without governance?} In contrast to L2s with dedicated governance,  \ks{Conor here you suggested that I add a reference for L2s without governance, but I did not because here we talk about Ethereum} Ethereum does not have one, and instead relies on any upgrades being accepted by the majority of stakeholders. Notable examples where minorities of Ethereum stakeholders disagreed with upgrades include the DAO Hack hard-fork~\cite{wiki_the_DAO}, and \ks{ dimitris is here a reference that minorities disagreed for the following? Otherwise we will remove it} the Proof of Stake upgrade~\cite{EIP-3675}. \qb{should be consistent in proof-of-stake / Proof of Stake, w.r.t 3.1} \ks{done}
\end{enumerate} 

\iffalse

Any truly decentralized L1 needs to be throughput bottlenecked to allow a decentralized validator set to keep up with and reach consensus on state updates. To address the bottleneck of L1, scaling solutions in the form of layer 2s (L2s), L3s, or generally LNs for some $N>1$, have emerged. These LNs are execution environments that typically move one or more of the bottlenecked L(N-1) resources outside of the critical path of L(N-1) state progression. At the time of writing, the majority of LN users exist at L2, so without loss of generality, we will refer to L2s when discussing L1 scaling solutions. To the best of our knowledge, all of the L2 preconfirmation concepts we introduce can be applied at LN for any $N\geq 2$, unless otherwise stated.

Deploying an execution environment as an L2 instead of a standalone blockchain removes the need for the L2 to establish its own consensus protocol or dedicated economic security for securing state transitions (although these features can be added). L2s can tap into the user base of the L1, allowing L1 users to opt-in to locking their funds and using them within the L2. Many L2 solutions exist, including rollups, validiums, and Plasmas \cite{L2_versus_execution_sharding}. As in standalone blockchains, L2 state progresses through proposers proposing blocks, establishing a canonical list of blocks, and some eventual finalization of L2 state implied by these blocks on the L1. For the purpose of this document, we will refer to this canonical list of blocks as the L2 blockchain ledger.  Note, the exact process of finalizing L2 state is beyond the scope of this document. With respect to preconfirmations, two key L2-specific concepts are relevant:
\begin{enumerate}
    \item \textbf{L2 proposer selection:} A key factor impacting preconfs is whether an L2 is based or non-based. \begin{enumerate}
        \item \textbf{Based L2:} Delegates block proposing to the proposers of L1. 
        \item \textbf{Non-based L2:} Uses a custom proposer election mechanism. 
    \end{enumerate}
    \item \textbf{L2 governance:} L2s are semi-independent ecosystems that can utilize standalone governance for L2-specific upgrades and maintenance. L2 governance describes a set of L2 stakeholders who have special permissions to modify some or all of an L2's protocol specification. To the best of our knowledge, all L2s in production have some form of dedicated governance set, although exceptions without governance are possible \cite{W:NativeRollups-SuperpowersfromL1execution}. In contrast, Ethereum does not have dedicated governance, and instead relies on any upgrades being accepted by the majority of stakeholders. Notable examples of where minorities of Ethereum stakeholders disagreed with upgrades include the DAO Hack hard-fork \cite{wiki_the_DAO}, and the proof-of-stake upgrade \cite{EIP-3675} .
\end{enumerate} 
\fi

\section{General Definitions and Concepts of Preconfirmations} \qb{we should be consistent with the bolding of key terms in the definitions; some have it, some don't. Why not bold preconf in def.1?} \ks{done}
To define preconfirmations, we use the concept of logical predicates. A predicate function determines whether a given input to the function \qb{"to the function"?} \ks{done} possesses a specific property. In the blockchain context, a predicate function taking as input a blockchain ledger, as formed at a specific point in time (e.g. a slot in Ethereum), would return true if and only if the property defined by the predicate function is satisfied by the blockchain ledger. In this context, we define a preconf as follows:
 
    %Long intervals between blocks recorded on the blockchain ledger pose challenges for users and applications requiring prompt feedback on transaction status. As already mentioned, preconfirmations were proposed as a way to bridge the delay between transaction submission and confirmation (the transaction is considered confirmed when it is included in a block that belongs to the blockchain ledger)~\cite{W:Basedpreconfirmations}. 
    
    
    
    
    %Although preconfirmations may refer to arbitrary early commitments to state, in the context of transaction-based blockchains—the focus of this document—we define preconfirmations as follows:

        \begin{definition}
        \label{def:preconfer}
        For a given blockchain, a \textbf{preconf} is a commitment to some predicate function $\mathsf{f}$ such that: there exists a point in time -- after the preconfirmation is issued -- such that if the blockchain ledger at that time is given as input to the predicate, it will return true. 
        %An LX \textbf{preconfirmation}(\textbf{preconf}) is a commitment to (i) the position (or union of positions) of an LX transaction or a sequence of LX transactions in a future block in the LX blockchain ledger and possibly (ii) on the LX blockchain state before executing this transaction or sequence of transactions. The union of positions can cover all the available space in the blocks that will be added to the LX blockchain ledger during a well-defined period of time in the future (e.g. an epoch).  
        \end{definition}
         \par
     
     Preconfs can be implemented in many different ways. Key factors that distinguish preconf implementations include who is providing the preconf, the predicate the preconfer is committed to, and blockchain governance, if it exists. The type of preconf determines which applications and users benefit from them.  We distinguish and explain these varying preconf implementations throughout the document. In this document, we will focus on transaction-based preconfs defined below. \qb{consistency with transaction based and transaction-based, w.r.t 4.1 title and text} \ks{Done}
     
     %Unless otherwise specified and without loss of generality, the term preconf is used generically for any commitment to any future blockchain sequence.

    \subsection{Transaction-based preconfs}
    Transaction-based preconfs are preconfs with predicates that have hardcoded a transaction or sequence of transactions. The main types of preconfs studied in the literature are \textbf{inclusion} and \textbf{execution} preconfs (cf. \cite{W:APricingModelforInclusionPreconfirmations,W:AnalysingExpectedProposerRevenuefromPreconfirmations}) \ks{Dimitris here I think that is good to add apart from these references, also the first articles that introduced these terms} defined as follows:   
    
    %Depending on the preconfer, different types of preconfs can be provided with different scopes of commitments. The type of preconf determines which applications and users benefit from them. 
        %The simplest form of preconfs are \textbf{inclusion preconfs}. \ks{we need a reference here to show that this term has been already introduced by other works} 
        \begin{definition}
        For a given blockchain and transaction $\mathrm{tx_0}$, an \textbf{inclusion preconf} is a preconf where the predicate function returns true if $\mathrm{tx_0}$ is included in the blockchain ledger given as input.
        %An LX \textbf{inclusion preconf} is a commitment that an LX transaction or transaction sequence will be added to the LX blockchain
%ledger during a well-defined period of time in the future (e.g. an epoch). This is a type of preconfirmations with respect to Definition \ref{def:preconfirmation} where the preconfer commits to the union of positions that covers the entire available block space during the well-defined period, and the preconfer does not commit to the state before executing this transaction or sequence of transactions.
        \end{definition}        
        Generally, inclusion preconfs are useful when the primary concern of the user or application is ensuring that the transaction is included. Use cases include simple transfers or posting sequences of L2 transactions (batches) to L1~\cite{W:PreconfirmationsforVanillaBasedRollups,W:APricingModelforInclusionPreconfirmations}.  
        However, inclusion preconfs provide no meaningful guarantees for transactions seeking to act on \textbf{contentious state}~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations,W:APricingModelforInclusionPreconfirmations}. 
        \begin{definition}
        \label{def:contentious state}
        \textbf{Contentious state} is a state element upon which concurrent transactions attempt to act, creating a race condition.
        \end{definition}
        Examples of contentious state include arbitrage and liquidation opportunities on a blockchain. For a transaction trying to act on such opportunities, or contentious state in general, execution preconfs are more comprehensive commitments than inclusion preconfs~\cite{W:ATaxonomyofPreconfirmationGuaranteesandTheirSlashingConditionsinRollups}.
        \begin{definition}
        For a given blockchain, transaction $\mathrm{tx_1}$ and sequences of transactions $\mathrm{stx}_1$, an \textbf{execution preconf} is a preconf where the predicate is a function that returns true if $\mathrm{tx_1}$ is included in the blockchain ledger immediately after $\mathrm{stx}_1$.
        %An \textbf{execution preconf} is a commitment to the exact sequence of transactions executed up to and including the transaction. This is a type of preconfirmations with respect to Definition \ref{def:preconfirmation} where the preconfer commits to the exact position of the transaction (or sequence of transactions), and to the state before executing this transaction (or sequence of transactions).
        \end{definition}
        %\cm{made some direct edits to this sub-section, please review}
        We refer to transactions that have received inclusion or execution preconfs simply as inclusion preconfirmed and execution preconfirmed transactions, respectively. When the context of inclusion preconf or execution preconf is clear, we simplify this to just preconfirmed transaction.
        
        Providing execution preconfs is more complex and comes with additional constraints compared to providing inclusion preconfs. Execution preconfs can only be given for the current slot, as execution preconfs require knowledge of the pre-execution state (the sequence of transactions in the blockchain ledger before the current slot).
        Less strict execution preconfs are also possible, such as intents. An example of an intent is a request to exchange a specific amount of token A for some minimum amount of token B without a specific user transaction. Intent preconfs are outside the scope of this document. For more information on intent preconfs, see \cite{W:Intent-BasedArchitectureandTheirRisks, ERC-7521}.

         % Although execution preconfs can be given at any time in advance of expected fulfillment, not knowing the pre-execution state introduces risk for the preconfer.

        % At the time of writing, most execution preconf protocols being considered focus on sequencing commitments. 
        % \begin{definition}
        %     A \textbf{sequencing commitment} is an execution preconf for the state.
        % \end{definition}
        % Such preconfs can only be given during the current slot, as they require knowledge of the pre-execution state. However, less strict execution preconfs are also possible. These are called outcome commitments.
        % %, such as intents. These are outside the scope of this document, and documented in \cite...
    
        % \begin{definition}
        %     An \textbf{outcome commitment} is an execution preconf for a discrete predicate on the result.
        % \end{definition}
        % Outcome commitments are more general execution preconfs than sequencing commitments, and include commitments to:
        %     \begin{itemize}
        %         \item A state element: \textit{a token balance after a transaction sequence execution }
        %         \item A behavior: \textit{a} \texttt{Transfer} \textit{event will be emitted} 
        %         \item Execution status?: \textit{a transaction sequence will not revert}
        %         \item Atomic execution? - when a based proposer has a simultaneous lock on multiple rollups' state - atomic exec. of txs across rollups - capturing an arbitrage that spans different rollup dexs
        %         \item Relational conditions: \textit{the balance of one token will remain greater than another}
        %         \item Negative conditions: \texttt{receipt.logs} \textit{does NOT contain an} {OwnershipTransferred} \textit{event}
        %     \end{itemize}
        % However, in the case of an outcome commitment to a specific state element, not knowing the pre-execution state introduces risk for preconfer.

    %Builders know pre-state, but don't have a guaranteed chance of acting on the pre-state 
    %Determinism = commitment to post-state, but it need not be so strict: it's a commitment to an outcome, and you don't need to know pre-state to guarantee you personally will ensure that outcome (even at your own expense, this is what solvers do) 

        % \cm{ I removed a paragraph here as it was not generally true. Execution preconfs can be as simple as committing to the sequence, the proposer does not need to simulate the transaction against the entire state, instead only needing to do basic checks such as "isFeeValid".}
        %To provide credible execution preconfs, the transaction for which a user requests the preconf must first be simulated against the current state before any commitment can be made to the transaction producing the expected result. This simulation requirement introduces significant computational overhead. This creates natural barriers to entry, limiting the set of entities that can credibly provide execution preconfs. \qb{ is this last sentence general enough to explain the concept without having to introduce preconfers?}
        

    
    
    \subsection{Preconfirmers}
    \label{sec:preconfirmers_preliminaries}
        Preconfs are provided by preconfirmers, or preconfers for short. The entity that can perform the preconfer role depends on the layer and sequencing model considered. 
        \begin{definition}
        A \textbf{preconfirmer (preconfer)} is an entity that provides preconfs, with \textbf{preconfing} being the act of issuing a preconf by a preconfer.
        \end{definition}
        Preconfers have varying abilities to fulfill their commitments. Block proposers -- whether for L1 or L2 -- are ideal candidates for preconfers. This is because proposers can enforce fulfillment of their preconfs by virtue of their control over block construction and proposal.
        %\cm{I think the remainder of this paragraph can be removed. It's not very specific, and doesn't provide any additional information. Do we want to re-use the references somewhere else?} \qb{agreed} L1 and based L2 preconfs are provided by validators who are scheduled to propose in upcoming slots in L1. Similarly, based L2 preconfs can be issued by L1 proposers of the future slots, with the difference that they need to have opted in to do so. This is explained in detail in \hyperref[step1:preconfer_registration]{Section~\ref{step1:preconfer_registration}}. Non-based L2 preconfs can be delivered by the L2 proposer, if the L2 has a single proposer per block cf. \cite{Optimism, Arbitrum, ZKsync, Starknet}. \ks{Lin all these are non based L2s right?}
        
        Although proposers make ideal candidates for preconfing from a fulfillment perspective, preconfing comes with added complexity for proposers. Proposers can outsource this complexity by delegating their preconfing duties to gateways.
        \begin{definition}
        \label{def:preconfirmation}
        A \textbf{gateway} is a specialized entity that performs preconfing on behalf of proposers.
        \end{definition}
        As gateways lack direct control over block proposal/signing, preconfs sourced from gateways depend on the ability of the gateway to enforce fulfillment by the proposer~\cite{W:ThePreconfirmationGatewayUnlockingPreconfirmations:FromUsertoPreconfer, W:Ahead-of-TimeBlockAuctionsToEnableExecutionPreconfirmations,W:DelegationinBolt:OutsourcingSophisticationWhilePreservingDecentralization}. How exactly gateways deliver preconfs to the proposer is the focus of \hyperref[preconf_delivery]{Section~\ref{preconf_delivery}}.
        \cm{Editted. Aikaterini, please review.} \ks{Conor I  added recall that because we talk about PBS  MEV-Boost, and that in 90 \% belong to three builders in section 3. Also do not we need refernce to mev-commit here?}
        Another preconfer candidate is a builder in the current MEV-Boost PBS paradigm.  Recall that in MEV-Boost, builders construct blocks and bid for the right for their block to be selected for proposal by the proposer. Given a builder must construct a block without knowing whether or not the block will be proposed, preconfs offered by MEV-Boost builders are conditional on preconfing builders winning the MEV-Boost auction~\cite{W:PreconfirmationFairExchange,W:LeaderlessandLeader-BasedPreconfirmations}. That being said, recall that, at the time of writing, three builders typically win more than 90\% MEV-Boost auctions \cite{MEV.pics}. Therefore, acquiring preconfs from these builders may be a sufficient commitment for some users and applications. 
    
\section{The 6 steps of Preconfirmations}
\cm{I think we need a better less "colloquial" name}
This section analyses the general flow of a preconf protocol and the roles of its key participants. The flow begins when a candidate expresses interest in joining the protocol as a preconfer. Upon meeting the protocol’s registration requirements, the candidate becomes eligible for election as a preconfer. The protocol then enters a repeated interaction phase involving users who submit preconf requests and preconfers who respond to them with preconf responses. The final step of the preconf protocol flow focuses on the fulfilment of preconf promises and the on-chain publication of any preconfed transactions. An optional further step in the flow covers punishment of preconfers who behave maliciously. \ks{TODO: check whether we need to mention sth here for the option where an overseer signs preconfirmations for fair exchange} \hyperref[preconf_protocol_flow]{Fig.~\ref{preconf_protocol_flow}} illustrates a general overview of the preconf protocol flow.
    \begin{figure*}[htbp]
        \centering
        \includegraphics[width=0.9\textwidth]{figures/preconfProtocolFlow.png}
        \caption{Preconf protocol flow. \cm{Should Disputer be Overseer?}}
        \label{preconf_protocol_flow}
    \end{figure*}
    
\subsection{Step 1: Preconfer Registration}

\todo{consistency with 7.1; generalizable opt-in w.r.t slashable collateral}

\label{step1:preconfer_registration}
    The first step in our preconf protocol flow is preconfer registration (see \hyperref[preconf_protocol_flow]{Fig.~\ref{preconf_protocol_flow}}). Preconfer registration involves candidates signalling that they want to become a preconfer. For this signaling to result in a successful registration, the candidate must meet all applicable registration requirements/eligibility criteria \qb{should we pick one term?}. Each protocol has the freedom to set its own eligibility criteria for its preconfers. Some examples are the following.
    \begin{itemize}
        \item Proof that they are proposers. Generally, preconfers must have the ability to deliver the inclusion / execution of a transaction that they issued a preconf for. Some protocols may insist that preconfers be proposers of the underlying blockchain protocol. In more detail, the candidates may need to prove
        \begin{itemize}
            \item Membership of the L1 proposer set (for L1 and based L2 preconfs).
            \item Governance committee approval (for non-based L2 preconfs).
        \end{itemize}
        \item Deposit of some minimum collateral amount that may be subject to slashing~\cite{W:CrediblyNeutralPreconfirmationCollateral:ThePreconfirmationRegistry, W:PreconfirmationRegistry}.
        \item Proof that they are not blacklisted — \qb{again consistency in formatting of hypens} that is, they do not belong to a set previously blacklisted for misbehavior (cf. \cite{W:PreconfirmationFairExchange}).
        \item Proof that they belong to a whitelist. The preconf protocol can employ access lists. For example, a whitelist limits preconfers to a trusted set during a “training‑wheels” phase before permissionless launch~\cite{W:PacayaFork}.
        
    \end{itemize}

        \subsubsection{Preconfer Registry} \label{preconfer_registry}
        \begin{definition}
\label{def: preconf_registry}
        A \textbf{preconfer registry} is a smart contract wherein entities can opt in to preconfing, registering themselves as preconfers. This smart contract can: (i) verify whether a candidate meets the applicable registration requirements; (ii) hold collateral and enforce monetary penalties on preconfers deemed to have acted maliciously in accordance with contract rules; and (iii) determine the preconfer schedule.
        \end{definition}

        \ks{Lin could you please check the following 2 paragraphs?}
        Preconfer registries play an important role in their respective blockchains. For L2s, preconfer registries can be tightly coupled with the proposer election mechanism, including having full control over proposer election. For more details cf. Section \ref{preconf_election}.
 
 


        \iffalse
        For L2 preconfs, a preconfer registry is tightly coupled with the core L2 protocol. If an L2 chooses to enforce preconfs, then the registry will also dictate who is allowed to propose blocks~\cite{W:SequencerOpt-InDiscoveryandCommunication} \ks{ideally we need a reference also for non based L2, because this reference is for based L2}. In contrast, for L1 preconfs, a registry cannot control the proposer set; the L1 proposer election mechanism is unaware of any preconf registry. However, through EIP-7917 (\cite{EIP7917}), which grants smart contracts access to the proposer lookahead, L1 preconfer registries can still determine the preconfer schedule, that is, identify the preconfer assigned to each slot.
        \fi
 
        Basic preconfer registry designs can be entrusted to manage everything related to collateral and slashing of registered preconfers (e.g. \cite{W:Documentation-RegisteringasaProvider,W:PreconfirmationRegistry}). Other more forward thinking designs have moved to decouple registration from collateral and punishment management in an effort to have a unified ``universal" registry contract \cite{W:UniversalRegistryContract}. By decoupling where individual protocols can customize their slashing requirements outside of the core registry \qb{sentence is incomplete}. Although coordination and standardization efforts are required, this type of design has the potential to enable better coordination of the proposer election between the based rollups who delegate the proposer election to this unified preconfer registry (cf. \cite{W:CrediblyNeutralPreconfirmationCollateral:ThePreconfirmationRegistry}). For more details about the ``universal" registry contract cf. \hyperref[registry_implementations]{Section~\ref{registry_implementations}}).

        \subsubsection{Slashable collateral}
        \begin{definition}
            In the context of preconfs and specific preconfer, \textbf{slashable collateral} is an amount of tokens that can be slashed in the case of that preconfer's misbehaviour. 
        \end{definition} 
        Any preconfer action that violates the slashing conditions as set out in the registry contract can lead to slashing of the preconfer collateral during Step $6$. Given these conditions reflect the behaviours that are acceptable from a preconfer, the threat of losing some or all slashable collateral as a result of violating a slashing condition acts a deterrent to dishonest preconfer behaviour. Slashing of collateral, and alternative punishment methods are thoroughly discussed in \hyperref[preconfer_punishment]{Section~\ref{preconfer_punishment}}.  

        \subsubsection{Management of collateral}
        %\lo{would say it is pretty much a requirement rather than "some occasions"} \cm{is the difference trying to be addressed here the ability for the registry contract to slash? In this case, Lin is correct, but Demetris may also be correct in that the collateral may be stored elsewhere e.g. through restaking. Regardless, this needs to be clarified with references.} \dk{I was indeed referring to cases where collateral is stored elsewhere like restaking, it is mentioned in the next sentence but maybe it should be clarified}, 
        
        As mentioned in \hyperref[preconfer_registry]{Section~\ref{preconfer_registry}}, registry contracts can directly manage slashable collateral. This requires users to lock up a dedicated collateral to the registry which cannot be reused for other purposes. Therefore, protocols may want to rely on third-party restaking platforms for sourcing slashable collateral, such as the EigenLayer platform~\cite{W:RestakingOverview}. Restaking allows collateral to be reused for multiple purposes, making it an attractive capital-efficient means for sourcing collateral, albeit introducing risks related to stake being slashed in multiple protocols at once. This risk reduces the per-unit security of restaked collateral vs single-use collateral deposited directly to a preconfer registry. For more information on these trade-offs, see \cite{W:Restaking101:APrimeronEigenLayer}. \lo{The final point is an interesting one, heard some teams wanting ability to have dedicated collateral for their protocol. And IIRC EigenLayer provides this.}
    

        \subsubsection{Registry implementations} \label{registry_implementations}
        \ks{Lin could you please take a look at this subsection? i have rewritten it to address all the comments}
        At the time of writing, each preconf protocol implements and deploys its own standalone registry contract, such as \cite{W:Documentation-RegisteringasaProvider,W:TaikoPreconfDesign}.

        However, as already mentioned, a different approach has received general support recently, the Universal Registry Contract (URC)~\cite{W:UniversalRegistryContract,W:GitHub-UniversalRegistryContract}. The aim of URC is to create a universal and generic open-source contract that replaces the need to create individual registries and supporting contracts for each preconf protocol. The URC standardizes:
        \begin{itemize}
            \item The preconfer registration and collateral posting.
            \item How monetary penalties are enforced when the preconfer deviates: This contract accepts proofs (submitted by any user) that the preconfer has violated slashing conditions specified off-chain in the preconfirmation response. If the proof is valid, the contract enforces the corresponding slashing penalties as outlined in the preconfirmation response. For example, the proof may include the preconfirmation response stating that the preconfer will pay 1 ETH if they fail to include the transaction in the next block, along with evidence that the transaction was indeed omitted from that block.
        \end{itemize}
        \iffalse
        
        aims to 
        :
         \begin{itemize} 
             \item Preconfer registration.
             \item Preconfer discovery. \lo{"discovery" sounds like finding the RPC endpoint of preconfer, in which URC doesn't help.}
             \item Collateral posting and management.
             \item Restaking integrations with preconf protocols. \lo{URC can support retaking integration, but it doesn't standardize it.}
             \item Slashing and enforcement logic. \lo{URC doesn't standardize slashing logic, just the enforcement part.}
         \end{itemize}
\fi
        Lastly, in an attempt to make preconfirming accessible to solo-stakers with limited resources, \cite{W:CrediblyNeutralPreconfirmationCollateral:ThePreconfirmationRegistry} suggests integrating an additional collateral delegation method. Collateral delegation allows validators to delegate their stake to a proposer who wishes to act as a preconfer but does not possess the required collateral. If the proposer deviates, the delegating validators also suffer a loss of their stake.
However, implementing this mechanism is not straightforward. There are several challenges and risks to address, such as designing an incentive mechanism that splits rewards and penalties between proposers and delegating validators. This mechanism must be carefully structured to disincentivize proposers from misbehaving and validators from supporting proposers who do. 
       \iffalse 
        submit a collateral for 
        the formation of proposer pools and improves capital efficiency for large operators who wish to split their collateral into multiple pools. However, implementing this idea is not straightforward and there are risks and barriers to overcome first. \qb{such as?}
        \fi
\\
\ks{ I have merged section for step 2:election  with the above. You can find the previous text in iffalse}
\iffalse
\subsection{Step 2: Preconfer Election}
\ks{This subsection is confusing to me. The eligibility is discussed in the previous subsection. Here we do not need to discuss eligibility again; we need to discuss how eligible preconfers are elected (e.g such as the lookahead paragraph. Whitelisting and Blacklisting should me moved above}
        Each preconf protocol sets its own preconfer qualification criteria. 
    In addition to registering, a preconfer is required to meet some eligibility criteria before being elected as a preconfer.
        \subsubsection{Eligibility criteria}
        \cm{This section was not focused on eligibility. I've editted but will need further work. Feel free to edit and add} 
        Each protocol has the freedom to set its own eligibility criteria for its preconfers. Generally, preconfers must have the ability to deliver the inclusion / execution of a tx that they issued a preconf for. Some protocols may insist that preconfers be proposers of the underlying blockchain protocol. Other requirements include the deposit and maintenance of slashable collateral, and non-membership of any preconfer blacklists. 
        % add: Competition is possible (ETs: Spire, Value-capturing based rollups) - delay economics of competition to later section
        \paragraph{collateral}
        \paragraph{lookahead}
        \label{sec:step2_lookahead}

In based preconfs, the preconfer is the next opted‑in L1 proposer listed in the proposer lookahead. The lookahead must therefore be (i) stable and (ii) directly accessible within the EVM, enabling L1 contracts to identify the expected preconfer and, for example, ignore submissions from anyone else.

        \paragraph{whitelist / blacklist}

The preconf protocol can also employ access lists. For example, a whitelist limits preconfers to a trusted set during a “training‑wheels” phase before permissionless launch, or a blacklist that bars entities who violated fair‑exchange guarantees or were previously slashed.

        \subsubsection{Election}
 \fi       
\subsection{Step 2: Preconfer Election} 
\label{preconf_election}

\cm{There are few nuances to election, so I will attempt a rewrite of this subsection}

Election of preconfers couples the underlying proposer election mechanism of a blockchain with the preconfer registry. In many L2s, the preconfer registry and proposer election are aware of each other, and in some cases, they are the same smart contract \cm{Taiko whitelist, centralized sequencer links}. In contrast, L1s and based L2s are not typically aware of the preconf registry, or even that preconfs are taking place. In all cases, the preconfer registry must be consulted to identify the schedule of preconfers, and for what slots preconfs can be provided.

If the current proposer of a blockchain is not a preconfer, then execution preconfs cannot be credibly provided, even if future proposers in the proposer lookahead are preconfers. This is because the current proposer has control over the next blockchain ledger update, and as such, future preconfers cannot know the blockchain ledger on which they will act.

On the other hand, inclusion preconfs can be issued by any preconfer in the proposer lookahead. This is because any such proposer-preconfer can fulfil the inclusion preconf regardless of the sequence of transactions in the blockchain ledger before their slot.  

that the preconfer registry w.r.t. Def \ref{def: preconf_registry} specifies the entity who will be the next preconfer among the registered ones \qb{incomplete sentence}. Usually, the preconfer is the registered entity that is elected to propose the next block in the underlying blockchain. Thus, the way the next preconfer is elected depends on the type of the underlying blockchain and the way this blockchain elects proposers. 

\begin{itemize}
    \item L1: Proposers are determined via the L1 proposer election mechanism. Through EIP-7917~\cite{EIP7917}, which grants smart contracts access to the proposer lookahead, L1 preconfer registries \ks{ we need here references for L1 preconfer registries}.—while not responsible for electing L1 proposers—can still determine the preconfer schedule by finding the intersection of the registered preconfer set and the proposer lookahead.
    \item Based L2s: In based L2s, L1 proposers are assigned as L2 proposers, with preconfers selected from the set of registered L1 proposers in the L1 proposer lookahead. As mentioned earlier in this section, if the L1 proposer of a given slot is not registered as a preconfer, execution preconfs cannot be provided for that slot.
    \item Non-based L2s: Within non-based L2s, there is a large proposer election design space. The preconfer registry can either read from the outputs of a stand-alone proposer election mechanism, or be integrated into the proposer election mechanism with the L2 requiring proposers to be registered as preconfers~\cite{W:SequencerOpt-InDiscoveryandCommunication}. \ks{Ideally, we need a reference for non-based L2s as well, since this citation pertains to based L2s. are these non-based\cite{Optimism, Arbitrum, ZKsync, Starknet}? Otherwise we need to refer them somewhere else becaus ethese references were removed from section 4.}
    
\end{itemize}

There is an interesting preconfer election design not perfectly handled by the above broad-stroke categorizations which is being considered in some protocols \cm{Lin, post whitelist Taiko reference? anything else}. Some L2s designs are being considered where L2 proposers must be registered as preconfers, with proposers selected from the L1 proposer lookahead, as in based L2s, unless there is no registered preconfer in the lookahead. In this case, a fallback L2 proposer is selected who is registered for in the preconfer registry. This categorization looks somewhat like our categorization of based L2s, apart from when no registered preconfer exists in the proposer lookahead. 




%based, with based priority over preconfs, 
%based, with preconfs, priority over based
%In L2s, the right to propose the next block can be determined by the preconfer registry itself, as it is tightly integrated with the core L2 protocol~\cite{W:SequencerOpt-InDiscoveryandCommunication}. \ks{Ideally, we need a reference for non-based L2s as well, since this citation pertains to based L2s.} In contrast, for L1, a registry cannot control the proposer set; this is determined by the L1 proposer election mechanism. However, through EIP-7917~\cite{EIP7917}, which grants smart contracts access to the proposer lookahead, L1 preconfer registries—while not responsible for electing L1 proposers—can still determine the preconfer schedule; that is, they can identify the preconfer assigned to each slot \ks{ we need here references for L1 preconfer registries}.
\subsection{Step 3: Preconf Request} \label{preconf_request}
    As soon as a registered preconfer is elected, users who wish to receive preconfs can begin submitting their signed preconf requests (see \hyperref[preconf_protocol_flow]{Fig.~\ref{preconf_protocol_flow}}). Depending on the protocol, users can route their request to the preconfer via P2P~\cite{W:Documentation-Understandingmev-commit} or through RPC endpoints~\cite{W:Taiyi-off-chaincomponents,W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking}. The request structure can vary from protocol to protocol. That being said, preconf requests typically include (but are not restricted to) the following:


    

    \begin{itemize}
        \item \textbf{Transaction(s):} Requests are expected to include the transaction(s) for which the user wishes to receive a preconf. Some protocols have attempted to use preconfs to describe the ahead-of-time commitment to include a transaction(s) or block where the executable transaction/block data has not been specified yet ~\cite{W:Proposer-CommitmentInfrastructureinEthereum,W:OpportunitiesandConsiderationsofEthereumsBlockspaceFuture, W:BlockspaceFutures}. These contracts are sometimes referred to as blockspace deliverables or futures.   We will not consider blockspace futures/deliverables as preconfs in the remainder of this article. Instead we focus only on preconfs where the transactions(s) to be included in a block are committed to by the preconfer when responding to a preconf request. \cm{Is this a necessary addition? In some protocol designs where preconfs are provided by proposers and blocks are built by builders, users can hide their txs from the builders until a preconf is provided preconf~\cite{W:PreconfirmationsundertheNOlens}}. \qb{I don't think it hurts, and think it's better suited here than in any of the other steps. Presumably you meant "...from the builders until their transaction is provided a preconf." - edit: although, isn't this in essence covered by "privacy preferences" at the end of this subsection?}
        
        \item \textbf{Preconf tip:} The preconf tip is the compensation to be paid to the preconfer for the preconf. In some protocols, the tip is atomically bundled with the transaction that requires inclusion preconfirmation. This means that the preconfirmer cannot redeem the tip without including the transaction (cf. \cite{W:TheDerivationPipeline}). 
        However, it is also important that the preconfirmer does not receive the tip if they either fail to include the transaction or delay issuing the preconfirmation. In Section \ref{fair_exchange_problem}, we discuss how, and under what assumptions, it can be ensured that the preconfirmer receives the tip if and only if they sign the preconfirmation request in a timely manner.
        %It is atomically binded to the tx so the preconfer cannot redeem the tip without honouring the preconf \lo{Not sure if it has to be atomically bound. For example, you can have non-atomically-bound tip but quick preconfs enforced via fair exchange solution. In a sense, centralized seq can be thought of doing this.}. 
        The tip is a key incentive for preconfers to provide preconfs and as such, proper tip pricing models are crucial. Preconf tip pricing is handled in detail in \hyperref[EconomicViabilityOfPreconfs]{Section~\ref{EconomicViabilityOfPreconfs}}. \ks{we need to check later this link}
        % \cm{finish with something like: pricing is handled in detail in later Section, Section ABC}
        % \cm{for the final document, it doesn't make sense to me to go off topic for the next paragraph and talk about calculating tips. I think this is part of incentives/MEV section which should be later in the doc}
        % However, calculating a sufficient tip is non-trivial and can be very challenging. Preconfers are required to solve an online MEV problem and decide whether to accept or reject a preconf request without having a complete image of all the potential txs they can include in the block. This means that the tip should be alluring enough to make the preconfer commit to including/executing a tx instead of rejecting it for the possibility of increasing MEV later within the slot. Subsequently, the preconfer has a motive to delay responding to requests in order to maximise MEV which leads to the fair-exchange problem that will be further investigated in the next paragraphs~\cite{W:StrawmanningBasedPreconfirmations}. \cm{this comment is referring to what paragraphs? I don't see the logical next here} \qb{agreed}
        
        \item \textbf{Preconf type:} 
        % \cm{why doesn't preconf type need to be specified by all} \qb{I think because the section starts with the idea that the user signs a request that contains some parameters, but the actual type of preconf requested can in some protocols be deduced from the structure of the preconf request itself, hence it doesn't need to be specified (don't recall exactly which article it was, just remember reading it)}
        Provided that the protocol and/or the preconfer support both inclusion and execution preconfs, users might need to specify which type of preconf they want.
    \end{itemize}

    Requests may also contain more nuanced parameters:
    \begin{itemize}
        \item \textbf{Deadline:} A deadline parameter sets the latest possible slot/time after which a request should be considered void, and its transaction(s) no longer includable by the preconfer~\cite{W:PreconfirmationsforVanillaBasedRollups}. 
        
        \item \textbf{Tip decay/escalator mechanism:} 
        The preconf tip may need to change during the duration of a request to reflect a request submitter's urgency for a preconf to be fulfilled \qb{did we explicitly state what we mean with fulfilment? since a few sentences later we state tip escalation incentisitivses the "eventual preconfirmation"}. A tip decay mechanism decrements the tip that can be redeemed by a preconfer over time. This can incentivise preconfers to respond in a timely fashion~\cite{W:Documentation-BidDecayMechanism}, or reflect some additional value that a transaction provides a preconfer while waiting in the mempool. On the other hand, a tip escalator mechanism increments the tip over time. This incentivises a preconfer to eventually preconfirm a transaction~\cite{W:OrderflowauctionsandcentralisationII:orderflowauctions}. \ks{this article discusses for escalating pricing but not for preconfirmations. Do we have a better reference for this claim?} \cm{no, it only has been discussed formally for non-preconfs. I think it is still relevant, but can omit if any issues.} Tip escalators can be deployed where preconfers are competing to preconf transactions. This likely makes tip escalators more appropriate for inclusion preconfs, as execution preconfs typically require exclusive preconfers.   
        
        \item \textbf{Preconf penalty:} Instead of relying on a predetermined penalty system, it is possible that users define penalties for preconfer faults related to a specific request through a request parameter~\cite{W:User-DefinedPenalties:EnsuringHonestPreconfBehavior, W:Documentation-BidStructure}. The idea is to allow users and preconfers to mutually agree on a level of crypto-economic security where a ``one-size-fits-all" approach does not suffice.
        
        \item \textbf{Latest blockchain state:} 
        It is possible for protocols to allow users to specify a commitment to existing blockchain state in their request~\cite{W:AnalyzingBFTProposer-PromisedPreconfirmations}. This gives users control over what blockchain state their request acts on.
        
        \item \textbf{Privacy preferences:} 
        Privacy-preserving techniques may be applied to preconf requests to hide key request data from block proposers before they issue the preconfirmation. Techniques include public-key encryption, or trusted intermediaries as are used in MEV-Boost works today~\cite{W:BasedPreconfirmationswithMulti-roundMEV-Boost, W:AnalyzingBFTProposer-PromisedPreconfirmations, W:Documentation-BidStructure, W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking}. % unwanted entities in the block-building pipeline \qb{are there "unwanted entities" in the pipe-line? perhaps untrusted fits better?}, including some subset of preconfers, or even from preconfers themselves until a response is provided. Techniques include public-key encryption, or trusted intermediaries as are used in MEV-Boost works today~\cite{W:BasedPreconfirmationswithMulti-roundMEV-Boost, W:AnalyzingBFTProposer-PromisedPreconfirmations, W:Documentation-BidStructure, W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking}.
         
    \end{itemize}
    
    
\subsection{Step 4: Preconf Response} \label{preconf_response}
        
    After observing a preconf request and verifying its validity, the preconfer must then choose whether to provide a preconf or not. This section describes the process of responding to preconf requests. Generally, preconfers should be incentivised by the protocol to provide timely responses to users in order to improve UX. Incentivising timely preconf responses is discussed in detail in
    \hyperref[fair_exchange_problem]{Section~\ref{fair_exchange_problem}}. 
    
    % \cm{following paragraph needs to be clearly and precisely rewritten} A preconf response accepting a request is essentially a preconfirmation (preconf), i.e. a commitment by the preconfer to include/execute a tx. Additionally, rejections do not necessarily constrain preconfers from including the tx in the block unless they are specified by the protocol as non-commitments. Non-commitments are slashable commitments by preconfers to not include the tx~\cite{W:SolutionstothePreconfFairExchangeProblem}. 
    
    Sending a preconf response \qb{"in response to"?} a preconf request binds the preconfer to a commitment to include or execute the preconfirmed transaction. In many protocols, preconfirmation responses also serve as evidence for punishing dishonest preconfers who fail to deliver on their stated commitments (cf. URC described in Section \ref{registry_implementations}). %\qb{Now that we have a clear definition for fulfillment, we should be consistent} \ks{Done}. 
    Typically, a preconf response is signed by the preconfer and it includes (but is not restricted to):

    \todocm{ensure standardised preconf responses are discussed in the context of the universal registry. It may be more appropriate to state this once in the URC section} \ks{ As specified in the URC section, preconfirmation responses are not defined by URC itself; instead, users and preconfer can agree on the format off-chain. The user can submit this preconfirmation response to the urc contract, along with relevant block data, as proof that the preconfer misbehaved.}

    \begin{itemize}
        \item \textbf{Unique identifier to a preconf request:}
        A response must contain a unique mapping to the request it is directed at. A hash of a signed request is such a mapping~\cite{W:Documentation-Commitments}.
        
        \item \textbf{Block number containing the requested transaction or validity period:} Some preconf protocols may require the preconfer to disclose the number of the block that will contain the requested transaction, or commit to the period during which the preconfirmation will be fulfilled~\cite{W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking}.

        \item \textbf{Updated blockchain state:} For execution preconfs, the preconfer may be required to provide a commitment to the updated blockchain state at the instant when the preconf response was provided~\cite{W:AnalyzingBFTProposer-PromisedPreconfirmations}. This commitment can be to the blockchain state before/after the response transactions was executed, or simply the stream of transactions executed up to and including the response.
        \item \textbf{Timestamp:} The time at which the preconfirmation response was issued (cf. \cite{W:DeveloperDocs}).
    \end{itemize}
    

\subsubsection{Fair-Exchange of Preconf Requests and Responses} \label{fair_exchange_problem}
    Equally important to the core concepts of requests and responses is the fair exchange of requests and responses. 
    \begin{definition}
        
    The \textbf{fair exchange problem} states that during a mutual exchange of items between two parties, it is vital to guarantee that both parties or neither party receive the expected item. No party should have the ability to gain an advantage by misbehaving or quitting the transaction prematurely~\cite{P:Fairexchangewithasemi-trustedthirdparty,T:Fairnessinelectroniccommerce}.
    \end{definition}

    In the context of preconfs, users should have some expectation of how and when responses are received after submitting a request. This expectation depends on many factors, including but not limited to the type of preconf, the tip being paid, the cost to provide and deliver the preconf, the relative demand for transactions/preconfs at the time the request was sent, and the value that a preconfer can extract from the preconf beyond the tip. Crucially, a preconf user's expectation has a time component built in, i.e. users typically want preconfs sooner rather than later. This makes the fair exchange of preconfs more complex than eventual fair exchange of request and response. \cite{W:PreconfirmationFairExchange} introduces this concept of timely fair exchange, specifically focusing on its importance in preconf protocols. Previous work on fair exchange proved that it is impossible to enforce fair-exchange without an overseer to identify preconfer faults~\cite{P:OntheImpossibilityofFairExchangewithoutaTrustedThirdParty}.
    
    \begin{definition}
    \label{def:overseer}
    In the context of preconfs, an \textbf{overseer} is an entity or set of entities that is trusted to observe the actions of preconfers, and provide signals to the protocol in the case of a preconfer's deviation from protocol rules or expected actions. These signals can include proofs of deviation, although some deviations may not be provable, depending instead on overseer trust. Overseer signals may be communicated on-chain through protocol smart contracts, or off-chain through P2P communication layers.
    \end{definition}

    Several overseer election mechanisms have been discussed. The primary distinction of these protocols is based on whether the overseer can signal preconfer misbehaviour in-protocol or not. In-protocol signaling allows for explicit preconfer punishment, something which is discussed in \hyperref[preconfer_punishment]{Section~\ref{preconfer_punishment}}.
    Such overseers can be elected through governance, or be required to hold some large amount of a blockchain's native token for which the preconfs are being provided. Both of these preconfer election mechanisms align overseers with the success and reliability of the preconf protocol. 
    
    For overseers who are expected to signal preconfer deviation out-of-protocol, several solutions have been discussed to date. In \cite{W:PreconfirmationFairExchange}, users are collectively identified as a suitable overseer in certain preconf protocols. Users can use the threat of withholding orderflow from a misbehaving preconfer to incentivize preconfers to follow protocol rules. The effectiveness of orderflow withholding as a threat depends on the expected profit of a preconfer from preconfs. This in turn is influenced by the frequency of being elected as a proposer/preconfer and the availability of block space. (cf. \cite{W:Future-ProofingPreconfirmations}).
    %is greatest when there is a single preconfer for the duration of the protocol, as in single-proposer L2s. For every additional preconfer added to the preconfer set, the effectiveness of orderflow loss is diminished proportionally to the number of preconfers; if a preconfer only has access to orderflow once every $N$ slots in expectation, the threat of orderflow loss for that preconfer is $1/N$th of the threat in the single preconfer case. As such, if possible, elected overseers should be favoured over users to enforce timely fair exchange of preconfs with a large/permissionless set of preconfers. 
    
    Wallet providers operating as out-of-protocol overseers on behalf of users is also discussed in \cite{W:PreconfirmationFairExchange}. As wallet providers are more sophisticated than a typical blockchain user, wallet providers may be better suited to identify preconfer deviations.
    In a similar vein, \cite{W:ThePreconfirmationGatewayUnlockingPreconfirmations:FromUsertoPreconfer} presents the concept of gateways or relays acting as overseers on behalf of users by monitoring preconfer behavior and withholding requests or tips. However, as gateways and relays are also being considered as preconfers\todocm{verify relays distinct from gateways in preconf section}~\cite{W:ThePreconfirmationGatewayUnlockingPreconfirmations:FromUsertoPreconfer}, alternative overseer solutions must also be considered. 
    

\subsection{Step 5: Delivery/Publication of Preconf} \label{preconf_delivery}

\dk{need to link proposer and preconfer to comply with the diagram}

Preconfs depend on some mechanism to ensure that any predicates committed to by a preconfer can be satisfied. Without such a mechanism, a preconfer's promise is not credible or meaningful. To describe this process of satisfying a preconf's predicate, we introduce the concept of delivery in the following definition:

\begin{definition}
    \label{def:delivery}
    A preconf is considered \textbf{delivered} if and only if the predicate specified by the preconf is satisfied in the blockchain ledger. Satisfying a preconf's predicate is equivalent to delivering said preconf.
    \end{definition}

It is a preconfer's ability to deliver a preconf that provides a preconf protocol with utility. This section focuses on the different mechanisms that preconfers can use to deliver preconfs. These delivery mechanisms depend on many factors, including but not limited to:
\begin{itemize}
    \item What layer of blockchain the preconfs apply to.
    \item How much of a block is being preconfed, and how any remaining blockspace is filled when only a percentage of a block is being used for preconfs.
    \item Whether the preconfer is a proposer or gateway.
\end{itemize} 
These tradeoffs are examined in the following Delivery Tradeoffs subsections.

\subsubsection{Delivery Tradeoffs: Based vs Non-Based}

For L1 and based L2 preconfs, the L1 proposer controls proposal of L1 blocks, and so can always propose an L1 block containing any and all preconfs. For non-based L2s with a single proposer, delivery is also controlled by the proposer themselves. 

In the case of non-based L2s with mutliple proposers,  the L2's consensus mechanism \cm{Aik-- what's the correct term for finalization we're using? It should be used here} impacts a preconfer's ability to deliver preconfs. In some non-based L2s, it may be sufficient to just propagate the block to the P2P layer for consensus. However, some non-based L2s require that an L2 proposer's blocks must appear in the L1 ledger by a certain proposal deadline to be considered valid. In this case, an L2 preconfer can only deliver their preconfs if an L1 proposer includes the corresponding L2 blocks on L1 by the proposal deadline, which is not guaranteed. 

\subsubsection{Delivery Tradeoffs: Full Block Preconfs vs Partial Block Preconfs}

In the case where a full block is being used for preconfs, a preconfer can build the block themselves and ensure delivery of all preconfs. In the case where only a partial block is used for preconfs, and the final block is built at proposal time, potentially including non-preconfs, there must be a mechanism in place to ensure the final block satisfies all preconfs. A simple algorithm for achieving this is including all preconfed transactions first in a block, followed by the remainder of the block. However, when any of these preconfed transactions are inclusion preconfs, this simple algorithm is likely sub-optimal for a proposer with regard to capturing block-building revenue. As inclusion preconfs can be placed anywhere in a block, a proposer can strategically place these preconfs to maximize their MEV revenue. 

That being said, this problem of maximizing the value of a block given some constraints has parallels to the ordered knapsack problem, which requires sophistication to solve~\cite{P:Partiallyorderedknapsackandapplicationstoscheculing}. To allow proposers to outsource this complex optimization problem while still receiving revenue from the solution, the Constraints API~\cite{W:ConstraintsAPISpecification} has been proposed as a tool to allow proposers to offer preconfs (or apply arbitrary constraints on a block), and then outsource the building of a block satisfying all preconf predicates to a set of builders, analogously to how proposers outsource building through MEV-Boost \cite{MEV-Boost}. 

\subsubsection{Delivery Tradeoffs: Proposer vs Gateway}
\label{delivery_tradeoffs}

Proposers are perfectly placed to provide preconfs, given their ability to deliver preconfs in their own blocks. Gateways on the other hand require additional machinery to ensure that a proposer proposes a block which delivers all preconfs provided by the gateway. The relationship between the proposer and gateway is crucial to the mechanism that must be used to deliver gateway preconfs. 

If the gateway trusts the proposer, a straightforward message-passing algorithm suffices to deliver preconfs from gateway to proposer to the blockchain ledger. Depending on whether or not the gateway is also tasked with sourcing the block for the proposer will dictate the time at which the preconfs must be sent back to the proposer, or whether the proposer even needs to observe the preconfs. In the case where the gateway also sources the proposer's block, for example if the gateway also runs MEV-Boost, the proposer can simply sign the block header and have the gateway propagate the final block to the P2P network, as in MEV-Boost.

If a gateway doesn't trust a proposer, the gateway would require cryptoeconomic guarantees that the proposer will propose a block that delivers all preconfs provided by the gateway. Cryptoeconomic guarantees from the proposer are especially important when the gateway is liable to be punished in the case where preconfs are not delivered. Such a guarantee could include shared punishment when preconfs are not delivered, or the existence of a mutually trusted overseer to arbitrate faults \cite{W:PreconfirmationFairExchange,W:FaultAttribution}. 

\cm{Potentially unnecessary The complexity, risk, and/or need for an overseer in the presence of untrusted gateways leads to a potential equilibrium point  \cm{something stronger here would be nice} where gateways are trusted, and establish themselves as reputable entities. \cm{ Link? Justin definitely said this}. With trusted gateways, this allows proposer-gateway delivery mechanisms to assume that any delivery faults were caused by the proposer -- and for proposers to be satisfied with this risk.}

\subsubsection{Designing Robust Delivery Mechanisms}\label{robust_delivery}

    In any preconf protocol where preconfer rotation takes place, it is possible that a preconfer fails to deliver their preconfs. Although this non-delivery may be malicious, non-delivery of preconfs can also be unintentional. Some thought has been given to protecting against unintentional failures to deliver preconfs.
    
     The authors of \cite{W:AvoidingAccidentalLivenessFaultsforBasedPreconfs} suggest that preconfers can collaborate with subsequent preconfers through revenue sharing to preconf the same transaction sequences in the event that the original preconfer fails to deliver the preconfs themselves. This approach is termed \textbf{chaining} preconfs. Although the exact incentives and guarantees of chaining are unexplored, chaining provides a protocol design direction to protect preconfers and their users from the risks of failing to deliver preconfs. 
     \cm{Any other examples here?}
       
    
\subsection{Step 6: Preconfer Punishment} \label{preconfer_punishment}    
    \cm{this section is bigger than just punishment, I think the name needs to be slightly more general}
    % tx(s)/intent/operation \dk{maybe we need a name for "tx(s)/intent/operation" to avoid writting the whole thing over and over again} \cm{maybe request is appropriate? We can make this connection in the request section if so.} was included or executed as specified by the preconf request and response. 
    Preconfer punishments are an important tool that can be utilized to ensure preconfers deliver preconfs according to any restrictions set out by the protocol, a request, and/or a response.
    
    \subsubsection{Preconfer Faults} \label{preconfer_faults_and_punishing_conditions}
    There are various faults that a malicious or negligent preconfer can commit that jeopardise the smooth operation of a preconf protocol. Fig.~\ref{preconfer fault tree} presents a decision tree that categorises preconfer faults. Preconfer faults are as follows:

    \paragraph{Safety Fault}
        \begin{definition}
            A \textbf{safety fault} occurs when the proposer/preconfer publishes a block which violates a preconf predicate to which the preconfer committed.
        \end{definition}
        A safety fault will never be committed by an honest preconfer. Thus, the punishment is expected to be severe~\cite{W:Basedpreconfirmations}.
        
        
    \paragraph{Liveness Fault}
    \todolo{Add definition nuance regarding missing slot for based L2 vs others}
    \par
    Unlike safety faults, liveness faults are slightly different for L1s and based L2s compared to non-based L2s. We define liveness faults in the respective blockchains as follows:
    
        \begin{definition}
            A \textbf{liveness fault for L1 and based L2 preconfs} occurs when an L1 proposer does not publish an L1 block for a particular slot, meaning all preconfed transactions for that slot are not included in the respective blockchain ledger.
        \end{definition}
         \begin{definition}
            A \textbf{liveness fault for non-based L2 preconfs} occurs when the L2 proposer does not publish an L2 block to the P2P network, meaning all preconfed transactions for that slot are not included in the L2 blockchain ledger.  \end{definition}

        Unlike safety faults, liveness faults could be accidental and non-malicious, for example, due to a power outage or internet downtime. Therefore, protocols may prefer a lighter penalty for liveness faults or introduce delivery mechanisms that mitigate the risk of preconfirmers being slashed for accidental violations, as discussed in \hyperref[robust_delivery]{Section~\ref{robust_delivery}}.        
        %That being said, from the perspective of the user, liveness faults can be indistinguishable from safety faults and may need to be punished severely~\cite{W:Basedpreconfirmations} \cm{this is a bold statement, so we need an example if this is true.}. 

            
        % To mitigate the punishments needed in the case of an accidental liveness fault, \cite{W:AvoidingAccidentalLivenessFaultsforBasedPreconfs} suggests a chained preconf system where following preconfers in the lookahead can honour a preconf that was not fulfilled by the active preconfer due to liveness failure. \cm{Introducing a protocol like this requires 1 or 2 more sentences so the SOK is self-contained. Why would the following preconfer chain preconfs? Any limitations to this chaining protocol?}
        
    
    %\paragraph{Condition Fault \dk{or Broken request conditions or parametric fault or Specification Fault or Constraint Fault}} \ks{ I would omit this, because for the case of txs that we examine these faults are included in the safety faults (I have amended safety faults to include them). For example here \cite{W:Basedpreconfirmations} they define safety faults as ``A promise safety fault occurs when the preconfer’s slot was not missed and the promise is inconsistent with preconfed transactions included onchain." If we agree to omit it we need to update the image to remove it also from there. Lin is it ok?}
        %\begin{definition}
            %A \textbf{condition fault} occurs when a preconfirmed tx is included on-chain but the preconfer fails to comply with the conditions specified in the preconf request and agreed upon in the preconf response.
        %\end{definition}
            
        %As explained in \hyperref[preconf_request]{Section~\ref{preconf_request}}, users can set various parameters in their preconf request. If the preconfirmed tx(s) is included or executed, but without complying with the conditions set by the user, the preconfer should be liable to punishment~\cite{W:DelegationinBolt:OutsourcingSophisticationWhilePreservingDecentralization}.
        
    \paragraph{Idleness Fault}
        \begin{definition}
            An \textbf{idleness fault} occurs when a preconfer receives valid preconf requests but neglects their duty and fails to provide preconf services.
        \end{definition}
       Although idleness faults are not well-documented, it is natural for some preconfirmation protocols to require and enforce that preconfers issue preconfs under certain conditions, e.g. preconfing all valid requests, or preconfing all requests paying tips greater than a certain amount.
            
        As illustrated in \hyperref[preconf_response]{Section~\ref{preconf_response}} and \hyperref[EconomicViabilityOfPreconfs]{Section~\ref{EconomicViabilityOfPreconfs}}, \dk{this should be adjusted to point to preconf pricing}, there are various factors that can influence a preconfer's decision to provide a preconf, such as the preconf tip and the incompatibility of conflicting transactions. As idleness faults depend on requests being delivered to the preconfer but not being responded to, this introduces a subjective observability requirement that could potentially be handled by a trusted party such as an overseer as presented in Section \ref{fair_exchange_problem}, Def \ref{def:overseer}) \ks{in that definition the overseer was defined only for fair exchange, i am not sure if we need to add a more general definition or leave it as it is}. 
        
        %As illustrated in \hyperref[preconf_response]{Section~\ref{preconf_response}} and \hyperref[EconomicViabilityOfPreconfs]{Section~\ref{EconomicViabilityOfPreconfs}}, \dk{this should be adjusted to point to preconf pricing}, there are various factors that can influence a preconfer's decision to provide a preconf, such as the preconf tip and the incompatibility of conflicting txs. Therefore, idleness faults can be handled by an overseer \cm{if not handled by an overseer, who else can handle this? Personally, I think we can say something stronger "likely need to be handled"}.

    \begin{figure}[htbp]
        \centering
        \includegraphics[width=0.9\textwidth]{figures/preconferFaultDecisionTree.png}
        \caption{Preconfer fault decision tree. \cm{condition fault needs to be changed to safety fault}\dk{done, if happy with it we can remove the comment}}
        \label{preconfer fault tree}
    \end{figure}
    

\subsubsection{Enforcement Mechanisms (EM) and Proofs of Malicious Behaviour}
\label{sec:enforcement}
    Preconf protocols rely on some form of economic incentives to encourage honest preconfer behaviour. These incentives are provided by mechanisms that either explicitly or implicitly punish malicious preconfer behaviour. 
    \begin{definition}
    \label{def:enforcement}
        An \textbf{enforcement mechanism} (EM) 
        triggers punishment of a preconfer when the preconfer satisfies one or more punishing conditions. 
    \end{definition}

    There are many possible EM implementations. Key differences between EMs include whether the overseer responsible for observing punishing conditions is permissionless or permissioned, the type of proof required to trigger preconfer punishment, and the level of punishment~\cite{W:PreconfirmationFairExchange}.

    In a permissioned overseer setting, observation and triggering of punishments are driven by the permissioned overseer. Generally, the proofs required to initiate punishment for permissioned overseers are less rigorous.  Punishing conditions do not necessarily need to be proven to be satisfied, potentially only requiring an overseer signature. When proofs are not required to trigger punishments, this raises concerns about overseer abuse ~\cite{W:PreconfirmationFairExchange}.

    In a permissionless setting, anyone can act as an overseer to initiate punishment via an EM. Contrary to the permissioned setting, permissionless overseers must be required to submit conclusive and indisputable evidence to trigger explicit preconfer punishments via the EM. Such evidence includes a signed preconf request, response pair disagreeing with the blockchain ledger. When indisputable evidence is not available, some form of arbitration between preconfer and overseer(s) must take place. As triggers are disputable in this case, this exposes permissionless overseer EMs to incorrect or unsatisfactory triggering and punishment~\cite{W:GitHub-UniversalRegistryContract,W:GitHub-ExampleSlasherImplementations,W:PreconfirmationFairExchange}.

    \subsubsection{Punishments} \label{punishments}
    
    As mentioned in the previous section, preconfer punishments can be divided into \textbf{direct} and \textbf{indirect} punishments, depending on how punishments are applied to a preconfer's net worth. Direct preconfer punishments involve preconfer collateral slashing, while indirect preconfer punishments target revenue from preconfs~\cite{W:PreconfirmationFairExchange}. For example, if a preconfer is punished through blacklisting~\cite{W:PreconfirmationFairExchange} for a specific period, the preconfer forfeits all revenue from preconfs during that time.
    
    Preconfer punishments can also be divided into \textbf{real-time} and \textbf{ex-post} punishments, depending on when punishments are applied \cite{W:PreconfirmationFairExchange}. In real-time punishment, preconfer's actions are monitored by an overseer and any misbehaviour is immediately detected preventing the preconfer from making any profit. For instance, in real-time punishments, the preconf responses may also need to be signed by the overseer. This means that the issuance process can be disrupted not only when the preconfer is idle, but also if the overseer fails to perform their role. This creates a dependency on overseer liveness for the preconf protocol to function.
    
    Ex-post punishments penalise dishonest preconfers retroactively. This removes the preconfer as a liveness dependency for the preconf protocol. However, ex-post punishments typically requires preconfers to lock up collateral that can be slashed. If any of the slashing conditions are violated, the preconfer loses a predetermined amount of their collateral. Moreover, a preconfer can be temporarily blacklisted, i.e. be deprived of their right to provide preconfs or have their stake temporarily frozen. In addition to these explicit punishments, EMs can also limit the preconf orderflow of dishonest preconfers or downgrade their reputation to affect future orderflow~\cite{W:PreconfirmationFairExchange,W:User-DefinedPenalties:EnsuringHonestPreconfBehavior}, implicitly reducing preconf revenue.

\subsection{Open Questions}

\begin{openquestion} 
    {gh}
\end{openquestion}


\section{Preconf Economics}

By construction, preconfs require proposers to commit to blockspace earlier than block proposal time. However, without enforcement of preconfs or explicit preconf rewards, preconfers have an incentive to withhold preconf responses as late as possible. All else equal, delaying the issuance of preconfs allows proposers to build blocks using up-to-date information, while increasing the number of transactions in the mempool, and the number of possible transaction orderings. These are all factors that contribute to a preconfer's ability to extract MEV from the mempool \cite{W:AnalyzingBFTProposer-PromisedPreconfirmations,W:StrawmanningBasedPreconfirmations}. \qb{is there a reason we focus specifically on public txs here? we earlier talk about private orderflow i believe.; could we simplify here to something of the form: "All else equal, delaying the issuance of preconfs allows proposers to build blocks using richer information, improving the preconfer's ability to extract MEV."?} 

In contrast, user demand for preconfs translates to users having utility to receive a confirmation of transaction execution or inclusion before a proposer proposes a block. 

To address the tension of users wanting preconf responses quickly, and proposers wanting to wait as long as possible before a response is provided, proposer incentives are needed. We have already seen in \hyperref[preconfer_punishment]{Section~\ref{preconfer_punishment}} that the preconfer role can be subjected to punishment conditions to incentivize certain behaviours, including timely responses to requests. Just as punishments can be applied for slow responses, rewards in the form of preconf tips can be provided for timely responses. 

    This section focuses on preconf economics, with particular focus on how the revenue of proposers changes under preconfs, how preconfs are priced, and the general economic viability of preconfs. \qb{I feel we should mention the constraining to proposers as preconfers at the start of the section.} Although the enforcement mechanisms described in Section \ref{punishments} fall under the heading of preconf economics, we omit any additional discussion on punishments in this sections. \cm{is this satisfactory?} \qb{I think so}
\subsection{Impact of Preconfs on Proposer Revenue}
    
     Several works have attempted to model expected proposer revenue from preconfs (e.g.\cite{W:PreconfirmationsundertheNOlens,W:EstimatingtheRevenuefromIndependentSub-SlotAuctionPreconfirmations,W:AnalysingExpectedProposerRevenuefromPreconfirmations,W:APricingModelforInclusionPreconfirmations} \todocm{identify other pricing works}. \ks{\url{https://www.nethermind.io/blog/optimizing-restaking-yields-a-hybrid-quantitative-qualitative-model}}. Two key takeaways from the existing literature on this topic are as follows: 
     
         
    \paragraph{Key takeaways}
     
     \begin{enumerate}
         \item Inclusion preconfs are a straightforward way for proposers to increase their revenue without disrupting their expected revenue from existing block-building strategies, MEV-Boost, commit boost, or otherwise \cite{W:APricingModelforInclusionPreconfirmations}.
         \item Execution preconfs require preconfer sophistication and/or significant preconf-specific tip revenue to make execution preconfs economically viable for proposers with the option not to preconf \cite{W:PreconfirmationsundertheNOlens,W:EstimatingtheRevenuefromIndependentSub-SlotAuctionPreconfirmations,W:AnalysingExpectedProposerRevenuefromPreconfirmations}. 
     \end{enumerate}

    In the following sub-subsections, we provide a more detailed discussion of how these works address some of these questions. \qb{what questions? until now is statements.}
    
    \subsubsection{Inclusion Preconfs \& Proposer Revenue}

    \todocm{Key Takeaways from incl. preconf work}
    Inclusion preconfs provide proposers with a potential source of revenue through preconf tips without a clear need for increased proposer sophistication. This result is presented in \cite{W:APricingModelforInclusionPreconfirmations}. In this article, the authors show that thanks to the flexibility that inclusion preconfs give proposers with respect to where preconfed transactions can be included in a block, proposers can price inclusion preconfs using basic pricing models. More than this, proposers can sell significant amounts of block-space through inclusion preconfs without interfering with expected block-building revenues. \ks{ here we need to take  discuss that the proposer who has sold inclusion preconfirmation has restrictions when they use MEV-Boost, and they need a way to enforce them. e.g. \url{https://ethresear.ch/t/resistance-is-not-futile-cr-in-mev-boost/16762}. Also we need to add the third paragraph below starting ``As inclusion ... here } 
    
    The article identifies that block-space, measured in ETH per gas used, is most valuable at the start of Ethereum blocks, and least valuable at the end of blocks. Specifically, cumulative transaction fees in block-space follow a lognormal distribution. This aligns with results from MEV literature \ks{we need a reference here } that has formally proven that early access to contentious state (cf. Def. \ref{def:contentious state}) (e.g. the state of Decentralised Exchange applications built on Ethereum known as DEXs \ks{I mentioned contentius state. We need a reference for DEX here})  has significant value for sophisticated MEV extractors \cm{LVR reference}. As inclusion preconfs need only compete for the least valuable block-space, inclusion preconfs can be priced in the same way as this least valuable block-space. Given the logarithmic nature of cumulative transaction fees vs. block-space, basic price curves can be utilized by proposers to price inclusion preconfs for the first $X$\% of block-space, for any $X$ that avoids contention with the highest MEV parts of a block \ks{I think that this needs rephrasing because the first $X$\% block-space will always include the highest MEV part that is the first part of the block}. 
    \ks{the following paragraph needs to be after the last line of the first paragraph ``More than this, proposers can sell significant
amounts of block-space through inclusion preconfs without interfering with expected block-building rev-
enues."  and we need to add reference such that \ks{https://ethresear.ch/t/resistance-is-not-futile-cr-in-mev-boost/16762} regarding how the proposer when using PBS can ensure via the relayer that the builder will include the inclusion preconfirmed transactions they want }
    Critically, proposers offering inclusion preconfs can always reject preconfs, and utilize existing block-building methods at proposal time, such as MEV-Boost. Inclusion preconfs therefore stand as an easy-to-price add-on for proposers that can be offered with negligible probability of decreasing revenue. Of course, pricing sophistication is always possible. Although conservative inclusion preconf pricing can be employed to ensure proposer revenues do not decrease, proposers can increase expected revenues by offering prices in-line with preconf demand, up-to-date estimates of block-building revenues, as well as granular per-unit block-space pricing models \ks{are there any references that we can add here?}. 

    \subsubsection{Execution Preconfs \& Proposer Revenue}
    \todocm{settle on storyline}
    \begin{enumerate}
        \item ISSAs vs DSSAs
        \item ISSAs reduce revenue without tips
        \item DSSAs increase revenue, but require preconfer sophistication. 
        \item Where does chorus one article fit in?
    \end{enumerate}
    \ks{ we need to remove the above}

    % LEGO 1
    Meanwhile, an analysis by Nethermind \cite{W:EstimatingtheRevenuefromIndependentSub-SlotAuctionPreconfirmations} estimates that proposer's revenue will be significantly reduced with the introduction of independent sub-slot auctions (ISSAs) to facilitate execution preconfs.
        
    ISSAs is a proposal aligned with Multi-round MEV-Boost~\cite{W:BasedPreconfirmationswithMulti-roundMEV-Boost} and suggests splitting slots into rounds of equal length. For each round the proposer holds an independent auction to build sub-blocks which are then combined into a block. \ks{as this description applies for both ISSAs and DSSAs, we need here some details that are unique for ISSAs  }

    To perform the impact analysis, the components of proposer's profit were classified into categories. It is then forecasted that for most components the reward decays exponentially as the number of rounds per slot as the number of rounds increases \ks{this needs rephrasing: i think that you mean exponentially on the number of rounds}. Overall, it was estimated that 8 rounds can reduce proposer's rewards by 50\% while continuous preconfs (assuming unlimited rounds) can reduce proposer's revenue by 74\% compared to the conventional end-of-slot MEV-Boost auction.

    This result emphasises the importance of preconf tips as compensation for proposers. Additionally, it suggests that, in order to be viable, preconfs should be priced to at least match the proposers' loss from providing them. This could also be a first step towards answering question \textbf{\ref{Q_pricing}} about preconf pricing.
    
    % LEGO 2
    Further research by the same team presents the theoretical concept of dependent sub-slot auctions (DSSAs) for facilitating execution preconfs~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations}. \ks{I would put the following sentence after the description of DSSAs below}. According to the analysis, DSSAs can increase proposer's expected revenue compared to MEV-boost even without preconf tips. \ks{We can add the following:This could be a first answer to \ref{Q_why_proposer}. } \par
\ks{The description of DSSAs below needs editing; it is not clear to me how it works}
    Similarly to ISSAs, there is an auction for every sub-slot the winner of which has the right to build the sub-block of the sub-slot. The main difference between ISSAs and DSSAs is that the auction winner also becomes the \textit{active proposer}. The active proposer is the entity with the right to build the remaining of the Ethereum block, thus entitled to the expected revenue of the rest of the block \ks{based on the previous sentence we have multiple auction winners who became active proposers; how can all of them being entitled for the remaining block? }. The first active proposer of each slot is appointed as defined in the lookahead \ks{above it mentions that the auction winner is the active proposer; how can they get appointed based on the lookahead} and is responsible to bundle the sub-blocks together in a block at the end of the slot. Overall, the active proposer at any sub-slot has the right to build the sub-block or auction off the position of the active proposer for an amount that is at least as much as the expected revenue for the remainder of the slot. \ks{This needs a little rephrasing because the active proposer has the right to auction-off for a smaller amount (no?) but they are not incentivised} The active proposer can also decide whether to offer preconfs to further increase revenue from preconf tips.
\par \ks{the following paragraph does not read well; I cannot understand how the proposer's can increase their revenues at searcher's expense and what searchers need to do to increase their income. Also this paragraph is about DSSAs or is it irrelevant}
    In \cite{W:PreconfirmationsundertheNOlens} addresses about the impact of preconfs on proposer and searcher \ks{do you mean builders? Otherwise we need to descibe searchers in the section 3 where we explain PBS} rewards in the current PBS setup. It is projected that proposers could increase their revenues at searchers' expense. On the other hand, searchers will need to adapt their bidding behaviour and employ more sophisticated bidding strategies. With the introduction of preconfs, searchers can no longer rely on private communication with builders who have a probability of winning an auction to build a block. This happens because searchers will be able to receive execution preconf for a transaction directly by the proposer. Therefore, searchers are expected to start biding earlier and more aggressively to have their txs preconfirmed.
    
    \subsection{Preconf Pricing}
    
     Preconf pricing has follows two distinct paths. In the case of non-based centralized sequencer L2s \qb{do we standardize centralized vs. single-proposer?}, preconfers are expected to preconf any request which covers the expected cost of including that transaction on L1 and proving it, where applicable. 
     
     Pricing becomes more complex for permissionless proposer blockchains, where proposers are expected to maximize revenue e.g. through MEV extraction. This requires proposers to understand the value being forfeit when providing a preconf. Understanding this forfeited value, in theory, allows a preconfer to accept any preconf tip paying more than this amount. Although there is no established pricing method, several models for estimating the fair price of inclusion preconfs have been put forward~\cite{W:APricingModelforInclusionPreconfirmations,W:PricingTransactionsforPreconfirmation}. 
     
     \cm{Explanation of \cite{W:APricingModelforInclusionPreconfirmations} missing}

     In \cite{W:APricingModelforInclusionPreconfirmations}, the authors identify that blockspace demand, measured in ETH per gas used, is highest at the start of Ethereum blocks, and least valuable at the end of blocks. Specifically, cumulative transaction fees in block-space follow a lognormal distribution. This aligns with results from MEV literature \ks{we need a reference here } that has formally proven that early access to contentious state (cf. Def. \ref{def:contentious state}) (e.g. the state of Decentralised Exchange applications built on Ethereum known as DEXs \ks{I mentioned contentius state. We need a reference for DEX here})  has significant value for sophisticated MEV extractors \cm{LVR reference}. As inclusion preconfs need only compete for the least valuable block-space, inclusion preconfs can be priced in the same way as this least valuable block-space. Given the logarithmic nature of cumulative transaction fees vs. block-space, \cite{W:APricingModelforInclusionPreconfirmations} demonstrates that basic price curves can be utilized by proposers to price inclusion preconfs for any amount of block-space. \qb{as mentioned by Demetris, this is repeated from 6.1.1} As an extension of this pricing curve, the article identifies a pricing surface to incorporate the both the amount of gas to be used by the preconf, and the amount of gas already consumed in the block. 
     
    % Pricing Transactions for Preconfirmation
    The approach of \cite{W:PricingTransactionsforPreconfirmation} follows a similar methodology to \cite{W:APricingModelforInclusionPreconfirmations}, suggesting the use of historical transaction fees to price inclusion preconf tips. Rather than price inclusion preconfs using historical data for an entire block, \cite{W:PricingTransactionsforPreconfirmation} models inclusion fees using transactions from the middle portion of blocks. This portion of transactions represent transactions paying some premium without competing for contentious state, which the authors argue represents the same type of transaction orderflow as inclusion preconfs. Both articles identify a need to increase preconf tips as more preconfs are provided, and less blockspace remains available.

    There has been no meaningful pricing models proposed for execution preconfs, with the bounds provided in \cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations} being the main result in the area. For a preconfer, pricing execution preconfs amounts to continuously observing, analysing, and responding to incoming preconf requests throughout a slot. This is at least as complex computationally as building a single block at the end of a slot. Given the complexity and sophistication required to build whole blocks, as shown by the oligopolistic nature of MEV-Boost auctions, execution preconf pricing stands as a highly complex open problem. Some form of permissionless preconf pricing is being performed in Arbitrum's Time-Boost, although the algorithms being used to participate meaningful in Time-Boost remain proprietary and closed-source. \cm{Link: https://docs.arbitrum.io/how-arbitrum-works/timeboost/gentle-introduction . According to this dune query, the "Express Lane Leaderboard" table shows greater than 90 percent of auctions are being won by 2 people. Worth including https://dune.com/entropy -UNDERSCORE- advisors/arbitrum-timeboost ? }
    
\subsection{Economic viability of preconfs} 
\label{EconomicViabilityOfPreconfs}
    
    In contrast to execution preconfs, for inclusion preconfs, proposer's expected profit from offering inclusion preconfs is greater than not offering them~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations}. 
 
    % Preconfirmations under the NO lens
    

    % LEGO 3
    

    Overall, concerning question \textbf{\ref{Q_diffs_inc_exec}} preliminary results of preconf viability research seem to converge to the conclusion that without preconf tips, execution preconfs are generally expected to decrease proposer's expected profit while inclusion preconfs are expected to increase it. Moreover, pricing inclusion preconfs is significantly easier and there is no effective method to price execution preconfs yet. \ks{This statement needs to be checked. According to the previous subsection DSSAs can increase proposer’s expected revenue compared to MEV-boost even without preconf tips, which contradicts with the statement of this paragraph}


    Accurately quantifying the benefits and the value of UX improvement remains a challenge. Computing revenue loss due to preconfs has been the subject of several works \cm{preconf economic references}, but calculating the value of improving UX and estimating a fair price that users would agree to pay for preconfs remains unexplored with respect to preconfs. We can observe that major non-based L2s offering fast preconfs are receiving large amounts of revenue. Isolating the utility of improved UX for users, and how this translates to preconfer revenue is an interesting are for further exploration. 


    \subsection{Open Questions}

    \begin{openquestion} \label{Q_why_proposer}
    What will be the trigger for proposers to become a preconfer instead of retaining the current MEV-Boost setup?
    \end{openquestion}
    \begin{openquestion} \label{Q_impact}
    {What is the expected impact of preconfs on proposers and searchers' \ks{ do we need searchers here, not builders? If yes we need to define searchers in PBS in Section 3} profit and what is the expected difference in revenue, risks and costs compared to the current block-proposing process?} \ks{ I have not seen this question mentioned in the section}
    \end{openquestion}
    \begin{openquestion} \label{Q_quantify_benefits}
    {Improving \ks{User Experience} UX has multiple direct and indirect benefits for a protocol and all its participants, but how can they be quantified?}
    \end{openquestion}


    \section{Preconf Risks \& Considerations} % \section{Additional implications/changes/effects}
    This section focuses on the risks, represented in red, and considerations, represented in blue, that may influence the design and implementation choices of a preconf protocol. It is essential to note that this list is not exhaustive as new risks and considerations may emerge, for example, with the introduction of new EIPs for Ethereum~\cite{W:Future-ProofingPreconfirmations}\dk{should we add this as a holistic consideration instead?} \qb{I think it makes more sense here, since it touches all that follows}. Furthermore,
    \hyperref[EconomicViabilityOfPreconfs]{Section~\ref{EconomicViabilityOfPreconfs}} discussed in length the economic viability of preconfing, therefore the viability of specific preconf protocol designs is not examined here. 
    % Furthermore, the economic viability of preconf protocols is a major consideration, but it will not be analysed further since it was already covered in depth in Section \dk{add reference to the Economics section}.

    \subsection{Preconfer caveats} \label{preconfer_caveats}
    An entity seeking to become a preconfer takes on additional risks and considerations. As discussed in Section~\ref{punishments}, in L1 and based L2s, preconfers may need to lock up slashable collateral and opt in to slashing conditions. This enables preconf protocols to punish preconfers ex-post for acting maliciously. Depending on the conditions to which the preconfer has opted in, there is a risk that they are slashed even when acting honestly. For instance, as discussed in Section~\ref{preconfer_faults_and_punishing_conditions}, a preconfer may be unable to fulfill their preconf response due to an accidental liveness fault. To mitigate this risk, some solutions have been proposed (cf. \cite{W:AvoidingAccidentalLivenessFaultsforBasedPreconfs}), in which preconfs can be fulfilled not only be the original preconfer but also by subsequent preconfers. In such cases, a portion of the tip is awarded to the preconfer who successfully filfills the preconf response. Moreover, even if the preconfer does not commit a fault—intentionally or unintentionally—they must still trust the enforcement mechanism (cf. Section \ref{sec:enforcement}), whether an overseer or smart contract, to ensure they are not unjustly penalized. Note that real-time punishments may not involve slashing; instead they rely on a trusted overseer responsible for signing preconf responses and distributing tips. In this case, the preconfer trusts the overseer for the fair exchange and liveness of the preconf protocol. For non-based L2s with a centralized sequencer \qb{we early on agreed to call these single-proposer L2s; were there developments w.r.t this while I was gone?} responsible for proposing L2 blocks, the sequencer is considered a trusted entity and typically does not lock up collateral, meaning it is not exposed to the same risks. \todo{what happens with non-based L2s with decentralized sequencers?}
    
        \begin{riskbox}{Slashing (For ex-post punishments in L1s and based L2s)} 
            \risk{Potential for being slashed, intentionally or accidentally, depending on the enforcement mechanism (Section~\ref{sec:enforcement}) and the slashing conditions (Section~\ref{punishments}).}
            \mitigation{Follow the protocol rules, and chain preconfs (cf. \cite{{W:AvoidingAccidentalLivenessFaultsforBasedPreconfs}}) \qb{have we explicitly described chaining? otherwise should reword to align with preceding text}.}
        \end{riskbox}

        As discussed in \hyperref[punishments]{Section~\ref{punishments}}, preconfer punishments can also be reputation-based. This type of punishment is used both as an ex-post punishment in L1s and based L2s, and as a punsishment in non-based L2s with a centralised sequencer \qb{see my earlier comment on centralized vs. single-proposer} that usually do not involve slashing. Reputation downgrading can induce serious economic consequences for malicious preconfers in the form of reduced orderflow. 
            \begin{riskbox}{Reputation}
                \risk{Potential reputation damage with subsequent economic repercussions (e.g.  reduced orderflow and thus reduced income from preconfs).}
                \mitigation{Compliance with protocol's rules and avoidance of malicious behaviour. \qb{aren't these in essence one and the same?}}
            \end{riskbox}
        
        \qb{not sure I agree with this risk} \ks{Are there any references that propose legal contracts between preconfers and users?} \qb{no; we discussed this risk in the context of an entity like coinbase providing preconf services but being liable to shareholders via legal channels} Beyond protocol-enforced risks of slashing, preconfers may also face legal risks. As preconfs resemble a formal agreement, preconfs could constitute a legally binding contract. If so, violating the protocol's conditions could carry legal implications for the preconfer.
        To mitigate this risk, preconf protocols may need to consider including explicit disclaimers to limit the legal liability of preconfers.
        \begin{riskbox}{Legal risks}
            \risk{Preconfs could be considered legally-binding commitments.}
            \mitigation{Protocols could include explicit disclaimers.}

            % make explicit that it is w.r.t there being a legal entity behind the proposer / preconfer that might face recompence for not upholding their commitments 
        \end{riskbox}
        \ks{the text below needs to be updated to match the newly added Section 5.5.3, and include more details for trade off between delegating the preconf duty or not }
        Preconfers are expected to be sophisticated entities. The complexity of being a preconfer and meeting capital requirements are considerations for potential preconfers~\cite{W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking,W:AnalysingExpectedProposerRevenuefromPreconfirmations}. For these reasons, some preconf protocols allow for preconfers to delegate their preconfing duties, as discussed in Section~\ref{sec:preconfirmers_preliminaries}. This has the added benefit of the delegated preconfer assuming the slashing and legal risks described above. 
        \qb{Suggested replacement: "Preconfers are expected to be sophisticated entitites. The complexity of being a preconfer and meeting capital requirements are considerations for potential preconfers~\cite{W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking,W:AnalysingExpectedProposerRevenuefromPreconfirmations}. For these reasons, some preconf protocols allow preconfers to delegate their preconfing duties, described in Section~\ref{sec:preconfirmers_preliminaries}. Delegation shifts the operational complexity of preconfing and in some cases transfers the aforementioned slashing and legal risks to the delegated preconfer. As discussed in Section~\ref{delivery_tradeoffs}, proposers are well-positioned to provide preconfs within their own blocks, whereas gateways require additional mechanisms to ensure delivery. If proposers delegate preconfing to a gateway, the gateway must either trust the proposer or secure cryptoeconomic guarantees that their preconfs will be honoured by the proposer. Delegation can therefore reduce the individual burden of acting as a preconfer, but comes at the expense of increased reliance on and coordination complexity between the proposer, gateway, and potential overseer."
        }
        
        \begin{considerationbox}{Requirement for preconfer sophistication}
            \consideration{Preconfing requires sophistication and capital.}
            \mitigation{Delegate preconfing duties to sophisticated entities.}
        \end{considerationbox}
        % Builders and other entities already have the infrastructure and experience to take on additional expertise. Consequently, proposers could delegate their preconf duties to them. However, delegation must be done in a controlled way otherwise it can lead to centralisation~\cite{W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking,W:AnalysingExpectedProposerRevenuefromPreconfirmations}. \todoqb{review sec}

        %not sure i would call this a risk/consideration for preconfers, but for the protocol itself
        % When all preconfer duties are performed by a single entity in each slot, fault attribution is relatively straightforward in case of punishing condition violation. Nonetheless, attribution becomes significantly more convoluted when duties are delegated or distributed~\cite{W:DelegationinBolt:OutsourcingSophisticationWhilePreservingDecentralization}
        % \begin{caveatbox}{Fault attribution}
        %     \consideration{ssss}
        %     \mitigation{tttt}
        % \end{caveatbox}
        % Protocols that support the separation of the preconf pipeline among multiple independent entities should carefully design mechanisms to ensure that fault attribution remains as transparent and objective as possible.


    \subsection{User caveats}
        Preconfers are not the only entity that will need to become more sophisticated. Preconfs also require additional sophistication from users~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations} \ks{here we need to add soem references mentioned in Section 6 about the complexity of pricing} \qb{section 6 is from the perspective of proposers, what would you reference for here from the perspective of users?}. As described in \hyperref[preconf_request]{Section~\ref{preconf_request}}, users requesting a preconf must calculate an appropriate preconf tip, compose a valid preconf request, and identify the right preconfer(s) or endpoint to send requests to~\cite{W:AnalyzingBFTProposer-PromisedPreconfirmations}. However, wallets might abstract away this complexity for users by creating preconf requests with default parameters, similar to how they automatically set the gas limit. They might also give users the option to manually set the preconf request parameters~\cite{W:PreconfirmationsforVanillaBasedRollups}, at the expense of added complexity. 
        \begin{considerationbox}{Requirement for user sophistication}
            \consideration{Added complexity for requesting preconfs.}
            \mitigation{Have wallets abstract away complexity.}
        \end{considerationbox}
        Another consideration for users is fees. As explained in \hyperref[EconomicViabilityOfPreconfs]{Section~\ref{EconomicViabilityOfPreconfs}}, the economic viability of preconfing, and by implication the service's provision, depends on incentives in the form of preconf tips. Preconfed transactions are therefore expected to have higher fees than regular transactions. There is no direct mitigation for users for the additional cost of preconf tips. However, if there is sufficient demand for preconfs, preconfers may require lower tips for this service to remain economically viable.
        \begin{considerationbox}{Fees}
            \consideration{Preconfs are more costly than regular transactions.}
            \mitigation{Out of users' hands; contingent on market dynamics.}
        \end{considerationbox}
       
        % Provided that preconfs are widely adopted, users who continue to submit non-preconfed transactions might face a disadvantaged position. It is possible that sophisticated users will use preconfs to front-run these users~\cite{W:AnalyzingBFTProposer-PromisedPreconfirmations}.
        % \begin{riskbox}{Front-run hazard for non-preconfed transactions}
        %     \risk{ssss}
        %     \mitigation{tttt}
        % \end{riskbox}
        %  The risk can be mitigated by seamlessly integrating preconfs in the ecosystem and mask additional complexity with the wallet.
        % % DK: NO CLEAR EVIDENCE FOUND TO PROVE THE EXISTANCE OF THIS:
        % \item \textbf{Deposit requirement:} 
        % % certain protocol desings
        % % not a widely adopted design choice
        % % requirement to maintain funds in multiple platforrms, depends on the design (not standard) some protocols require users to post a collateral (Proposer-Commitment Infrastructure in Ethereum)

    \subsection{Holistic caveats}
        Beyond specific considerations for users of preconf protocols, there are risks and considerations inherent to the protocol itself. 
        As with any protocol controlled by smart contracts, preconf protocols are prone to smart contract risks~\cite{W:SmartContractVulnerabilitiesandMitigationStrategies}. This risk may be amplified given the nascency and complexity of preconf protocols. Potential mitigation strategies include extensive auditing of contracts before they are deployed~\cite{W:CrediblyNeutralPreconfirmationCollateral:ThePreconfirmationRegistry}, or opting to use an overseer to handle preconfer punishments instead of a smart contract enforcement mechanism.
         \begin{riskbox}{Smart contract risk}
            \risk{Smart contracts are vulnerable to exploit.}
            \mitigation{Extensively audit contracts, or where possible, limit their use.} \ks{I think that we need to remove suggestion to limit their use, because smart contract enhance decentralisation compared to having an overseer or a trusted party} \qb{yeah perhaps worded poorly; i was trying to convey that one can instead trust an overseer}
         \end{riskbox}
         %  Another potential idea would be the creation of a competitive environment between different preconf protocols and between preconfer as proposed in \cite{W:ThePreconfirmationSauna}. Such an environment encourages a repeated game from which existing protocols will be improved and new protocols will emerge. 
         \ks{ here we need to take into account newly added section 5.5.3}
        As described in \hyperref[sec:preconfirmers_preliminaries]{Section~\ref{sec:preconfirmers_preliminaries}}, preconfers may delegate their preconfing duties to more specialised entitites, such as gateways. As preconfing becomes more sophisticated, fewer entities can reliably provide the service, and consequently, delegation is expected to grow. \qb{rewrite sentence} Centralizing preconfing to a few specialized entities may lead to rent extraction, censorship of select transactions, and introduces single points of failure~\cite{W:DelegationinBolt:OutsourcingSophisticationWhilePreservingDecentralization,W:BecomingBased:APathtowardsDecentralisedSequencing}.
        \begin{riskbox}{Centralization \qb{too broad of a term}}
            \risk{Monopoly pricing, censorship, and single points of failure}
            \mitigation{}
        \end{riskbox}

        \qb{rent seeking (subsumes monopoly pricing), censorship, in two different boxes}: monopoly pricing, censorship, liveness

        
        Furthermore, delegating preconfer rights to few specialized entities introduces a liveness risk~\cite{W:StrawmanningBasedPreconfirmations,W:BasedPreconfirmationswithMulti-roundMEV-Boost}. 
        % This is an issue with "streaming" continuous preconfs. 
        \begin{riskbox}{Liveness}
            \risk{Preconfing could halt if preconfers collude or go offline.}
            \mitigation{The proposer retains the ability to self-build a block}
        \end{riskbox}
        % Mitigation maybe fallback mechanism? 
        By minimizing latency to preconfers that continuously stream their preconfed transactions, some entities can gain asymmetric information on the latest chain state \ks{ I did not understand this claim. The execution preconfs are given only for the current slot after the latest block has been propagated} \qb{see for ex. \cite{W:StrawmanningBasedPreconfirmations}. Vertical integration w/ preconfers = get latest state first and act on that state last; Afaik, you can derive intra-slot state using provided execution preconfs. Since preconfers are incentivized to publicise their preconfed txs, this is relevant}. This enables them to maximize their back-running profit. Aside from creating inequalities among users, latency races can incentivize geographical centralisation~\cite{W:StrawmanningBasedPreconfirmations}. 
        Single-proposer protocols are more exposed to this risk as the location of the preconfer remains static. \ks{but this a risk for single proposers L1s in general not for preconfs, no?} \qb{Yes }
        This risk occurs as a result of the lack of an efficient pricing mechanism. A potential solution to latency race risk could be an auction-based system that batches preconfs in subslots instead of proving them continuously~\cite{W:BasedPreconfirmationswithMulti-roundMEV-Boost}.
        \begin{riskbox}{Latency races}
            \risk{Incentive to vertically integrate with preconfers.}
            \mitigation{A robust and reliable pricing mechanism or an auction-based pricing mechanism}
        \end{riskbox}
        % latency, spam, auctions
        % here w.r.t latency to preconfer from user 
        % mitigation is auctioning; compete over prices instead of latency
        
        Protocols in which the preconfer continuously streams their preconfed transactions may also be vulnerable to congestion risk. Especially in L2s where gas fees are lower, users can spam the network with probabilistic arbitrage attempts. Congestion increases gas prices as a result of increased demand for block space. At the same time, block space is wasted in failed arbitrage txs. Similarly to latency races, congestion occurs due to the absence of an effective pricing mechanism. The congestion risk could be mitigated with an auction-based system that encourages users to participate in a bidding contest instead of flooding the network~\cite{W:StrawmanningBasedPreconfirmations,W:BasedPreconfirmationswithMulti-roundMEV-Boost}.
        \ks{again this risk seems to be that exists even without the presence of preconfs, no?} \qb{agreed}
        \begin{riskbox}{Congestion}
            \risk{Network is flooded with failed arbitrage txs}
            \mitigation{A robust and reliable pricing mechanism or an auction-based pricing mechanism}
        \end{riskbox}

    % \subsection{L2 caveats}

    %      % not every L1 proposer has opted-in to give preconfs (Analyzing BFT & Proposer-Promised Preconfirmations)
    %     \begin{riskbox}{Increased delay on tx execution \cm{maybe not here}}
    %         \risk{}
    %         \mitigation{}
    %     \end{riskbox}


    %     \begin{considerationbox}{Correctly implementation of fallback mechanism \qb{discuss w conor}}
    %         \consideration{}
    %         \mitigation{}
    %     \end{considerationbox}




    % \subsection{For L2s}
    % \begin{itemize}
    %     \item \textbf{Increased delay on transaction execution: \cm{Maybe not here} } 
    %     % not every L1 proposer has opted-in to give preconfs (Analyzing BFT & Proposer-Promised Preconfirmations)
        
    %     \item \textbf{Fallback based preconfer needs to be implemented correctly:} % Mechanism that ensures liveness by reassigning preconfer rights when there is no active preconfer. This happends when there are no based preconfers left in current epoch or the current preconfers are not responding. (Sequencer Opt-In, Discovery and Communication, Becoming Based: A Path towards Decentralised Sequencing)
        
    %     %\item \textbf{Trade-off between centralised and decentralised sequencing:} % centralised: high thoughput, low latency, easy preconfs but it has centralisation, censorship, liveness hazards and trust requirements. Widely adopted based rollups with preconfs can achieve high performance (Becoming Based: A Path towards Decentralised Sequencing)
    % \end{itemize}

% -------------------------------------------------------------------------------------


        
    %     \textbf{Sophisticated preconfer requirement} 

    %     \textit{\textbf{Consideration:}}
    %     Preconf protocols are bound to have some sophistication requirements from the preconfers. The complexity requirements, paired with any implicitly necessary capital requirements, should be a serious consideration for potential preconfers~\cite{W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking,W:AnalysingExpectedProposerRevenuefromPreconfirmations}.
        
    %     \textit{\textbf{Mitigation:}}
    %     Builders and other entities already have the infrastructure and experience to take on additional expertise. Consequently, proposers could delegate their preconf duties to them. However, delegation needs to be done in a controlled way otherwise it can lead to centralisation~\cite{W:Towardsanimplementationofbasedpreconfirmationsleveragingrestaking,W:AnalysingExpectedProposerRevenuefromPreconfirmations}.

        
    %     \item \textbf{Fault attribution}

    %     \textit{\textbf{Consideration:}}
    %     When all preconfer duties are performed by a single entity in each slot, fault attribution is relatively straightforward in case of punishing condition violation. Nonetheless, attribution becomes significantly more convoluted when duties are delegated or distributed~\cite{W:DelegationinBolt:OutsourcingSophisticationWhilePreservingDecentralization}. 

    %     \textit{\textbf{Mitigation:}}
    %     Protocols that support the separation of the preconf pipeline among multiple independent entities should carefully design mechanisms to ensure that fault attribution remains as transparent and objective as possible.
        
    %     \item \textbf{Legal risk} 
        
    %     \textit{\textbf{Risk:}}
    %     The legal risk associated with preconfs is not widely discussed. However, the structure of a preconf shares common characteristics with a formal agreement, raising the question of whether a preconf could constitute a legally binding contract. If so, violating the protocol's punishing conditions could potentially carry legal consequences for the preconfer.
        
    %     \textit{\textbf{Mitigation:}}
    %     To mitigate this risk, protocols may need to consider including explicit disclaimers to limit the legal liability of preconfers.

    % \end{itemize} -------------
    
    % \subsection{User caveats}

    % \begin{itemize}
    %     \item \textbf{Increased gas prices}

    %     \textit{\textbf{Risk:}}

    %     \cm{Increased Demand increases gas cost, but increasing gas limits and throughput may counteract this. We need a reference?}
    %     The introduction of preconfs could have a collateral effect on gas prices. As explained in Section \dk{add reference to the Economics section}, the viability of preconfs lies in providing economic incentives to preconfers. To create that profit margin, preconfed txs probably need to be more expensive than the traditional ones. Furthermore, preconfs aim to improve UX which could in return increase demand for block space in general. This could have an impact on gas prices and affect all users, not just those who request preconfed txs.
        
    %     \textit{\textbf{Mitigation:}}
    %     \dk{TBC if preconfs are widely adopted then there will be less need for economic incentives for preconfers?}

        
    %     \item \textbf{Sophisticated user requirement}

    %     \textit{\textbf{Consideration:}}
    %     Preconfers are not the only entity that will need to adapt to sophistication requirements. Preconfs entail some additional sophistication for users as well~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations}. Users requesting a preconf must calculate an appropriate preconf tip, compose a valid preconf request (as seen in section \ref{preconf_request}) and identify the right preconfer(s) or endpoint to send it to~\cite{W:AnalyzingBFTProposer-PromisedPreconfirmations}.
        
    %     \textit{\textbf{Mitigation:}}
    %     A simple mitigation for this issue is to hide the complexity behind the wallet. Wallets could create preconf requests with default parameters, similarly to how they automatically set the gas limit, and give advanced users the option to manually set the preconf request parameters~\cite{W:PreconfirmationsforVanillaBasedRollups}.

        
    %     \item \textbf{Front-run hazard for non-preconfirmed txs}

    %     \textit{\textbf{Risk:}}
    %     Provided that preconfs are widely adopted, users who persist in submitting traditional non-preconfirmed txs might be placed in a disadvantaged position. It is likely that sophisticated users might be able to utilise preconfs to front-run conventional txs~\cite{W:AnalyzingBFTProposer-PromisedPreconfirmations}. 
        
    %     \textit{\textbf{Mitigation:}}
    %     The risk can be mitigated by seamlessly integrating preconfs in the ecosystem and mask additional complexity with the wallet.

        % % DK: NO CLEAR EVIDENCE FOUND TO PROVE THE EXISTANCE OF THIS:
        % \item \textbf{Deposit requirement:} 
        % % certain protocol desings
        % % not a widely adopted design choice
        % % requirement to maintain funds in multiple platforrms, depends on the design (not standard) some protocols require users to post a collateral (Proposer-Commitment Infrastructure in Ethereum)
    % \end{itemize}

% \subsection{For the ecosystem \dk{or everybody/systemic}}

%     \begin{itemize}
        % \item \textbf{Smart contract risk} 
        
        % \textit{\textbf{Risk:}}
        % Similarly to every Web3 protocol that is controlled by smart contracts, preconfs can be prone to smart contract risk, i.e. code errors and vulnerabilities~\cite{W:SmartContractVulnerabilitiesandMitigationStrategies}. The risk could be amplified because the concept of preconfs is recent, complicated and has not been thoroughly battle-tested yet. 
        
        % \textit{\textbf{Mitigation:}}
        % To mitigate the risk, smart contracts must be extensively audited to ensure that they are trustworthy before they are deployed~\cite{W:CrediblyNeutralPreconfirmationCollateral:ThePreconfirmationRegistry}. Another potential idea would be the creation of a competitive environment between different preconf protocols and between preconfer as proposed in \cite{W:ThePreconfirmationSauna}. Such an environment encourages a repeated game from which existing protocols will be improved and new protocols will emerge. Lastly, instead of relying on an EM of a deployed smart contract, protocols can make use of an overseer to have more fine grained preconfer punishments.

        
        % \item \textbf{Centralisation problem:} 

        % \textit{\textbf{Risk:}}
        % \cm{We need to add explanation of why centralisation is bad in general e.g. monopoly pricing, CR, SPOF, others?}
        % Inevitably, any implementation of preconfs will require a certain level of additional sophistication. As a result, preconfers may choose to outsource technical expertise by delegating preconf duties to gateways. The more complicated the protocol becomes, the less participants will be able to follow and less entities will be entrusted with preconfer duties. This could pose a major centralisation risk for the whole ecosystem~\cite{W:DelegationinBolt:OutsourcingSophisticationWhilePreservingDecentralization,W:BecomingBased:APathtowardsDecentralisedSequencing}.\dk{should we also talk about overseers here?}
        
        % \textit{\textbf{Mitigation:}}
        % \dk{TBC}

    
        % \item \textbf{Liveness}

        % \textit{\textbf{Risk:}}
        % Implementations that grant exclusive preconfer rights to a single entity in each slot might be exposed to liveness risk. Granting complete control creates a single point of failure and raises censorship concerns for the duration of the slot~\cite{W:StrawmanningBasedPreconfirmations,W:BasedPreconfirmationswithMulti-roundMEV-Boost}. 
        % % This is an issue with "streaming" continuous preconfs. 
        
        % \textit{\textbf{Mitigation:}}
        % \dk{TBC, maybe fallback mechanism?}
        
        % \item \textbf{Latency races}

        % \textit{\textbf{Risk:}}
        % Users could potentially benefit from having the lowest latency to the preconfers in protocols that offer continuous preconfs\dk{the term continuous preconfs should be explained, maybe in the economics section}. Minimum latency can maximise MEV back-running profit as users with the lowest latency can have priority to accessing the latest chain state and submitting back-run txs. Besides creating inequalities among users, latency races can also lead to geographical centralisation~\cite{W:StrawmanningBasedPreconfirmations}. 
        % Single-proposer protocols are more exposed to this risk as the location of the preconfer remains constant. 

        % \textit{\textbf{Mitigation:}}
        % A potential solution could be batching preconfs in subslots instead of proving them continuously~\cite{W:BasedPreconfirmationswithMulti-roundMEV-Boost}.

                
        % \item \textbf{Congestion}

        % \textit{\textbf{Risk:}}
        % Protocols that support continuous preconfs may also be vulnerable to congestion risk. Especially in L2s where gas fees are lower, users can spam the network with probabilistic arbitrage attempts. Congestion increases gas prices as a result of increased demand for block space. At the same time, block space is wasted in failed arbitrage txs. 
        
        % \textit{\textbf{Mitigation:}}
        % The congestion risk could be mitigated with an auction-based system that encourages users to participate in a bidding contest instead of flooding the network~\cite{W:StrawmanningBasedPreconfirmations,W:BasedPreconfirmationswithMulti-roundMEV-Boost}.
    
    % \end{itemize}

% \subsection{For L2s}
%     \begin{itemize}
%         \item \textbf{Increased delay on transaction execution: \cm{Maybe not here} } 
%         % not every L1 proposer has opted-in to give preconfs (Analyzing BFT & Proposer-Promised Preconfirmations)
        
%         \item \textbf{Fallback based preconfer needs to be implemented correctly:} % Mechanism that ensures liveness by reassigning preconfer rights when there is no active preconfer. This happends when there are no based preconfers left in current epoch or the current preconfers are not responding. (Sequencer Opt-In, Discovery and Communication, Becoming Based: A Path towards Decentralised Sequencing)
        
%         %\item \textbf{Trade-off between centralised and decentralised sequencing:} % centralised: high thoughput, low latency, easy preconfs but it has centralisation, censorship, liveness hazards and trust requirements. Widely adopted based rollups with preconfs can achieve high performance (Becoming Based: A Path towards Decentralised Sequencing)
%     \end{itemize}


\section{Implementations \& existing protocols}
    \cm{possibility: description of template protocol and subchapters elaborate on how each respective implementation diverges from template}
        \subsubsection{ \textbf{Primev's MEV-commit}}
        % https://docs.primev.xyz/v1.1.0/get-started/welcome-to-primev
        % https://docs.primev.xyz/v1.1.0/concepts/rewards-and-slashing/rewards-and-slashing
        % https://ethresear.ch/t/preconfirmation-fair-exchange/21891
        

        \subsubsection{ \textbf{Chainbound's Bolt}}
        % https://research.chainbound.io/
        % https://research.chainbound.io/delegation-in-bolt-outsourcing-sophistication-while-preserving-decentralization
        % https://research.lido.fi/t/proposal-onboard-bolt-to-the-lido-alliance/7724/2
        % https://research.chainbound.io/examining-the-based-sequencing-spectrum
        % https://research.chainbound.io/exploring-verifiable-continuous-sequencing-with-delay-functions
        
        \subsubsection{ \textbf{Taiko with Nethermind's enforcement mechanism}}
        % https://taiko.mirror.xyz/ejciROGOGM9L_DuuqM3KloZan0EQR73fJt8qzTZmVzg
        % https://4pillars.io/en/articles/preconfirmation-feat-taiko
        % https://en.theblockbeats.news/news/55848
        % https://taiko.mirror.xyz/7_FNvOGfu81imp6A6EucFDoRcKU6E94j4izNEPiugmE
        % https://ethresear.ch/t/rollup-centric-considerations-of-based-preconfimations/20160
        
        \subsubsection{ \textbf{Espresso}}
        % https://docs.espressosys.com/network/learn/the-espresso-network
        % https://ethresear.ch/t/preconfirmation-fair-exchange/21891
        
        \subsubsection{ \textbf{Eth gas}}
        % https://www.ethgas.com/
        % https://docs.ethgas.com/overview
        % https://research.lido.fi/t/introducing-ethgas-and-realtime-proposer-commitments-to-the-lido-community/9018
        % % Collateral: either on their L1 collateral contract or Eigenlayer AVS
        
        \subsubsection{ \textbf{Luban}}
        % https://luban-1.gitbook.io/tai-yi-v0/mfrlyXSvVliigkr4PsmM/taiyi-overview
        % https://lu-ban.notion.site/Consensus-Based-Preconfirmation-with-Multiple-Concurrent-Proposers-aea7f6a7c138401d83eaef429797b540
        
        \subsubsection{ \textbf{Rise}}
        % https://docs.risechain.com/rise-stack/based-rollups.html
        
        \subsubsection{ \textbf{Cairo}}
        % https://github.com/cairoeth/preconfirmations
        % https://ethresear.ch/t/towards-an-implementation-of-based-preconfirmations-leveraging-restaking/19211
        
        % \item \textbf{URC's enforcement mechanism}
        % https://eth-fabric.github.io/website/development/l1-components/urc
        % https://github.com/eth-fabric/urc
        % https://github.com/eth-fabric/urc/blob/main/docs/overview.md
        % https://github.com/eth-fabric/urc/tree/main/example
        % https://enshrined-punch-a86.notion.site/Universal-Registry-Contract-143f46539a18809095adf4a14a5ff216
        
        % \item \textbf{Commit-Boost}
        % https://commit-boost.github.io/commit-boost-client/
        % https://github.com/Commit-Boost
        % https://ethresear.ch/t/based-proposer-commitments-ethereum-s-marketplace-for-proposer-commitments/19517
        % https://ethresear.ch/t/commit-boost-proposer-platform-to-safely-make-commitments/20107
                

\subsection{Other theoretical designs}
% blockspace futures
% "Proposer-Commitment Infrastructure in Ethereum"
% "Pricing Future Blockspace: A Data-driven Approach"

\section{Open research challenges} % maybe "additional" 
\cm{possibility: future-proofing ETH from Aikaterini;}


\section{Conclusion}

\section*{Acknowledgements}




\newpage
\bibliographystyle{IEEEtran}
% \bibliographystyle{unsrtnat}

\bibliography{manual_references}
% \bibliography{references}

\appendix
\subsection{Economic viability of preconfs} 
    The concept of preconfs is still in an early stage. In order to obtain all-around support, it needs to be ensured that all key participants will have clear economic or practical incentives to adopt it. In this section, we discuss the financial uncertainties and costs of preconfs and delve into research findings and open problems concerning the economic viability of preconfs. 
    
    From a user's perspective, preconfs are a tool that improves user experience by providing faster finality and, potentially, protection from MEV attacks. However, UX improvement has some value on its own, which is very likely to be reflected in the price of transactions. In order to create profit margin for the rest of the key participants and compensate for lost MEV, preconfirmed txs will probably need to be more expensive than regular txs. Thus, preconf viability relies on users being willing to pay a little bit more for this improved UX. 

    From a proposer's perspective things are even more complicated. Proposers are profit-driven, and it should not be expected that they would adopt a protocol as an act of kindness. They would never opt-in to provide preconfs and shoulder further sophistication unless they are given satisfactory economic incentives. The same holds for searchers that will have to adapt to the new system and for gateways that will be designed to have preconf duties delegated to them by proposers. Thus, the viability of preconfs lies in providing earning margins similar to the ones that influenced the transition from the traditional solo block-building to PBS and MEV-boosted blocks.

    These observations raise a series of fundamental and mutually correlated questions that must be addressed if preconfs are to attain widespread adoption~\cite{W:EconomicViabilityofPreconfirmations}. 

    
    Answering question \textbf{\ref{Q_why_proposer}}, the way to motive proposers to become a preconfers is to provide them with economic incentives that will increase their revenue. Since the additional proposer profit will come from users' willingness to pay more for preconfs, there is a trade-off. Preconf tips should be priced so they are expensive enough to \dk{encourage proposers to provide preconfs but cheap enough to persuade users that faster finality is worth the extra cost.   }
 
    % Preconfirmations under the NO lens
    An analysis by Chorus One~\cite{W:PreconfirmationsundertheNOlens} addresses question \textbf{\ref{Q_impact}} about the impact of preconfs on proposer and searcher rewards in the current PBS setup. It is projected that proposers could increase their revenues at searchers' expense. On the other hand, searchers will need to adapt their bidding behaviour and employ more sophisticated bidding strategies. With the introduction of preconfs, searchers can no longer rely on private communication with builders who have a probability of winning an auction to build a block. This happens because searchers will be able to receive execution preconf for a transaction directly by the proposer. Therefore, searchers are expected to start biding earlier and more aggressively to have their txs preconfirmed.

    % LEGO 1
    Meanwhile, an analysis by Nethermind \cite{W:EstimatingtheRevenuefromIndependentSub-SlotAuctionPreconfirmations} estimates that proposer's revenue will be significantly reduced with the introduction of independent sub-slot auctions (ISSAs) to facilitate execution preconfs.
        
    ISSAs is a proposal aligned with Multi-round MEV-Boost~\cite{W:BasedPreconfirmationswithMulti-roundMEV-Boost} and suggests splitting slots into rounds of equal length. For each round the proposer holds an independent auction to build sub-blocks which are then combined into a block.

    To perform the impact analysis, the components of proposer's profit were classified into categories. It was then forecasted that for most components the reward decays exponentially as the number of rounds per slot as the number of rounds increases. Overall, it was estimated that 8 rounds can reduce proposer's rewards by 50\% while continuous preconfs (assuming unlimited rounds) can reduce proposer's revenue by 74\% compared to a single round MEV-Boost auction.

    This result emphasises the importance of preconf tips as compensation for proposers. Additionally, it suggests that, in order to be viable, preconfs should be priced to at least match the proposers' loss from providing them. This could also be a first step towards answering question \textbf{\ref{Q_pricing}} about preconf pricing.
    
    % LEGO 2
    Further research by the same team presents the theoretical concept of dependent sub-slot auctions (DSSAs) for facilitating execution preconfs~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations}. According to the analysis, DSSAs can increase proposer's expected revenue compared to MEV-boost even without preconf tips.

    Similarly to ISSAs, there is an auction for every sub-slot the winner of which has the right to build the sub-block of the sub-slot. The main difference between ISSAs and DSSAs is that the auction winner also becomes the \textit{active proposer}. The active proposer is the entity with the right to build the remaining of the Ethereum block, thus entitled to the expected revenue of the rest of the block. The first active proposer of each slot is appointed as defined in the lookahead and is responsible to bundle the sub-blocks together in a block at the end of the slot.

    Overall, the active proposer at any sub-slot has the right to build the sub-block or auction off the position of the active proposer for an amount that is at least as much as the expected revenue for the remainder of the slot. The active proposer can also decide whether to offer preconfs to further increase revenue from preconf tips.

    % LEGO 3
    In contrast to execution preconfs, for inclusion preconfs, proposer's expected profit from offering inclusion preconfs is greater than not offering them~\cite{W:AnalysingExpectedProposerRevenuefromPreconfirmations}. Furthermore, although there is no established pricing method, multiple formal models for pricing inclusion preconfs have been put forward~\cite{W:APricingModelforInclusionPreconfirmations,W:PricingTransactionsforPreconfirmation}.

    As explained in \cite{W:APricingModelforInclusionPreconfirmations}, Block size is limited by the blockchain protocol, yet not all sections of the block-space generate the same revenue for the builder. In fact, txs positioned at the top of the block have much greater value because they are executed first and they can be used for txs that are state-dependent and users are willing to pay more for them. The value of block-space decreases until it reaches its lowest value at the bottom of the block.
    
    Inclusion preconfs only guarantee the inclusion of a transaction which gives the block builder the flexibility to place them anywhere in the block. Therefore, a rational block builder would place txs with inclusion preconfs in the least valuable space of the block to save the more valuable space for txs that can generate more profit. At the same time, a rational user would acquire inclusion preconf for txs that cannot be exploited with MEV extraction.

    The pricing model exploits the idea that inclusion preconfs can be placed in the block-space with the lowest value. It suggests deriving the intrinsic value of inclusion preconfs by calculating the value of that least valuable section of the block. However, it is explained that the actual market price is shaped by many factors such as market supply-demand.

    % Pricing Transactions for Preconfirmation
    A different pricing model was presented by a Chorus One research team~\cite{W:PricingTransactionsforPreconfirmation}. This model agrees that txs should be preconfirmed only if they compensate for inclusion risk and produce expected revenue that is equal or greater than MEV-boost. However, the model follows a slightly alternative approach as it suggests using mid-block txs to price inclusion preconfs. Additionally, instead of explicitly pricing inclusion preconfs, it calculates a threshold expressing priority fee per unit of gas that a tx should have to be preconfirmed.

    Initially, the team categorised txs into three tiers based on their position in the block and demonstrated that, on average, the higher the position, the higher the builder's priority fee per unit of gas. Then, data from tiers 1 and 3 were excluded before training three different models (heuristic-based, linear regression, and random forest) that predict the threshold. Tier 1 data were excluded to reduce bias from private order-flow and MEV txs with high priority fees, tier 3 data were excluded to reduce bias from late tx arrival pricing premium.

    After evaluating the models, it was concluded that the random forest model seems to outperform the other two as it can capture more complex data relationships. Also, the results reveal a clear tradeoff as lower threshold means that more txs are preconfirmed, but the loss from incorrectly priced or unprofitable preconfs is higher.

    Overall, concerning question \textbf{\ref{Q_diffs_inc_exec}} preliminary results of preconf viability research seem to converge to the conclusion that without preconf tips, execution preconfs are generally expected to decrease proposer's expected profit while inclusion preconfs are expected to increase it. Moreover, pricing inclusion preconfs is significantly easier and there is no effective method to price execution preconfs yet.

    % Value-capturing based rollups with based preconfirmations
    For question \textbf{\ref{Q_based_seq_profit}}, current based rollups are designed so that all revenue is captured by the L1 proposer who controls sequencing. \cite{W:Value-CapturingBasedRollupswithBasedPreconfirmations} suggests a new protocol design that enables rollups to capture some value.

    According to the proposal, L1 proposers will be charged for sequencing rights in the form of an auction. Auction's profits will be absorbed by the rollup. Once the lookup of an epoch is known, each proposer of a slot i can bid to gain preconfer rights for a series of consecutive slots ending in slot i. The winner of the auction of each slot inherits the right to interact with rollup's smart contract to propose a new based rollup block. Owning sequencing rights for consecutive blocks can be more profitable than owning rights for two separate blocks which gives incentive to proposers to bid in the auction. Furthermore, L1 sequencers can increase their revenue by providing preconfs.

    As for question \textbf{\ref{Q_quantify_benefits}}, accurately quantifying the benefits and the value of UX improvement remains a challenge. Undoubtedly, enhancing UX improves the protocol and increases user utility and demand. At the same time, preconfs decrease MEV. Computing MEV loss is relatively simple, but calculating the value of increasing utility and demand and estimating a fair price that users would agree to pay for preconfs is still puzzling, especially without relevant data. It is possible that preconf protocols would need to go through a pilot phase of experimentation and data gathering which before they can properly answer this question.
\iffalse
    \open{work}
        \begin{openquestion} \label{Q_why_proposer}
    Why should a proposer become a preconfer instead of retaining the current MEV-Boost setup?
    \end{openquestion}
    \begin{openquestion} \label{Q_impact}
    {What is the expected impact of preconfs on proposers and searchers' profit and what is the expected difference in revenue, risks and costs compared to the current block-proposing process?}
    \end{openquestion}
    \begin{openquestion} \label{Q_pricing}
    {What are good algorithms and methodologies to price preconfs?}
    \end{openquestion}
    \begin{openquestion} \label{Q_diffs_inc_exec}
    {What are the differences between inclusion and execution preconfs in economic terms?}
    \end{openquestion}
    \begin{openquestion} \label{Q_based_seq_profit}
    Should all revenue from based sequencing be absorbed by L1 proposers or should the rollup itself capture some value?
    \end{openquestion}
    \begin{openquestion} \label{Q_quantify_benefits}
    {Improving UX has multiple direct and indirect benefits for a protocol and all its participants, but how can they be quantified?}
    \end{openquestion}
\fi
    \subsection{Layer 2s OLD}
    Ethereum prioritizes decentralization over performance. 
    L2s emerged as a response to the limited throughput of L1.
    Tradeoff between decentralization and throughput \cite{TheLimitstoBlockchainScalability}
    Generally, L2s resolve these issues by moving execution of transactions off of the L1 
    Several L2 scaling solutions exist
    Rollups are a common L2 type: work by executing txs on a rollup chain while posting tx data and cryptographic commitments to L1 for DA. 
    This refers to the provenance of data necessary to reconstruct the rollup state. Other L2 scaling solutions use alternative DA protocols rather than relying on L1. \\
    
    \textit{L2 Blocks and State Progression} \\
    \qb{rollups }



    
    \qb{section doesnt mention non-rollup constructions}
    \qb{the DA state roots are posted to the L1 which reference L2 blocks, these are used to update the canonical state of the rollup}
    L2 blocks are built by batching many L2 transactions into a single L1 transaction. These L2 blocks are then periodically submitted to the L1 in \textbf{batches} (multiple blocks per L1 transaction). 
    \qb{The L2 contract defines who is allowed to post. This can be explicit through permissioning or implicitly by disregarding transactions from non-permissioned proposers before state is published: The filtering can be either done in the L1 contract of within L2 execution; the L1 contract is responsible for either filtering at the proposal time or filtering at state root finalization - filtering of msgs to the contract are rejected if its not per the permissioned set of proposers at the L1 contract level, or at the L2 execution level, when it comes to finalziing state you refer to the collection of txs from permissioned proposers only; if you included any blocks that weren't from permissioned proposers you're subject to a fraud proof in the case of Optimism}
    %Batches of blocks enable compression of block data, leading to a more efficient use of L1 resources.
    Batches are submitted as an L1 transaction to the L1, from which the canonical ordering of L2 blocks can be derived. As in L1, L2 proposers are responsible for producing blocks and submitting them as batches to L1 to advance the L2 state. Generally, the \textbf{L2 smart contract} on L1 controls who has the right to propose L2 blocks. \todoqb{refine preceding sentence} Unlike in L1, L2 proposers are typically expected to build blocks of L2 transactions themselves, and are often referred to as sequencers. In most L2s, one entity is expected to have the exclusive right to propose blocks at any given time. 
    %By embedding L2 blocks in L1 transactions, the L1 provides the L2 with DA and settlement, while L2 provides execution.
    \\
    
    
    \textit{Non-Based L2s} \\ \todocm{rewrrite subsection}
    \textbf{Non-based L2s} represent the predominant L2 architecture, with the defining characteristic being that the L2 selects its own set of proposers. Non-based L2s often operate with a single proposer who has exclusive rights to propose blocks. This single-proposer setup is functionally a centralized block production pipeline, and "centralized sequencer L2" is often used to describe this architecture. 
    \qb{single sentence that defines a single-proposer L2 and the centralized sequencer terminology at once; if the distribution of proposal rights is to a single entity, we consider this a single-proposer L2, which is colloquially referred to as a centralized sequencer L2}
    \todoqb{shorten and clarify} Centralization in the context of L2s refers to distribution of block proposal rights to a single entity or a set of entities (a whitelisted set of proposers would be considered centralized), whereas sequencing refers to the specific ordering of transactions. We therefore use single-proposer L2 when describing an L2 architecture where sequencing and proposing are conducted by the same entity. The prevalence of single-proposer L2s can be attributed to their significant operational advantages. A single proposer maintains monopoly control over transaction inclusion and ordering, enabling some key benefits, including:
        \begin{itemize}
            \item Fast sequencing by default
            \item Cost-optimized submission of blocks to L1
            \item Reputational based sequencing rules and MEV protections; transactions can be sent directly to the sequencer
        \end{itemize} 

    %Perhaps most importantly, the sequencer's monopoly over block construction enables the provision of \textbf{preconfirmations} (or \textbf{preconfs}) - immediate promises to users that their transaction will be included in the next rollup block. With preconfs, users can receive near-instant feedback on transaction status, thereby bridging the gap between centralized system UX and blockchain security. However, this also means users must trust the sequencer for transaction inclusion and fair ordering, creating a single point of failure that could potentially censor transactions, extract MEV, or halt the rollup entirely. Because of the risk to \textbf{liveness} posed by a centralized sequencer, most rollup implementations include an \textbf{escape hatch} that allows users to bypass the sequencer and submit their transactions directly to the base layer, albeit with the longer delays and higher costs that rollups seek to solve.

    \textit{Based L2s} \\
    Based L2s are an alternative L2 architecture that delegate the responsibility of sequencing the L2 to L1 proposers. 
    In a \textbf{based L2}, L1 proposers typically collect L2 transactions/L2 blocks (from pipeline) from a dedicated L2 mempool and include L2 transactions directly within their L1 blocks. \qb{they collect them in the same way they collect L1 txs, once updated for pvt flow etc.; refer back to 3 section}  
    Being based enables shared sequencing of the rollup with the L1 and other based L2s. 
    However, inheriting sequencing properties from L1 proposers also means a relative lack of sophistication compared to dedicated high-resource single-proposer non-based L2s. For based L2s, this means more complex infrastructure and protocol design to compete on transaction confirmation latencies, and potentially/relatively \todoqb{justify relatively with a source, otherwise use potentially.} higher transaction costs due to the lack of coordination on block posting to L1 (non-based L2s can straightforwardly choose not to post blocks to L1 during L1 transaction fee spikes).

    Because L1 proposers handle both L1 and L2 transaction ordering in based L2s, L2 MEV is accessible to L1 validators rather than being controlled by the permissioned L2 proposer(s). While this may increase revenue for L1 validators, it stands to decrease the welfare of based L2 users versus their non-based counterparts. 
    %Non-based L2s typically prioritize user-focused sequencing. In contrast, the accessibility of L2 MEV to L1 validators in based L2s reintroduces the issue of non-user-focused sequencing at the L1. 
    % Preconfirmations are one potential solution to maintain user-focused sequencing in a based L2. \\
    
    % \lo{less +ve spin on MEV extraction?}
    % \cm{focus on fee revenue, potenitally touch on democratization (good?) vs anarchy and non-user focused extraction (bad!)}
    % Because L1 proposers handle both L1 and L2 transaction ordering, MEV opportunities from L2 transactions become accessible to the broader L1 validator set rather than being concentrated with centralized L2 sequencers. This means that more MEV revenue flows to the L1 validators securing the base layer. This has implications for L1 economic sustainability.  \qb{exposes users to L1 mev issues}
    
    % Therefore, preconfirmations were introduced.

    % Conclude with MEV democratization 

    % Potentially outsource L2 sequencing therefore via MEV-Boost too? 

    \textit{Governance} \\
    L2s are implemented as protocols independent of the L1 to which they are tethered \cite{SoK_L2s}. \qb{L2s are independent ecoystems that require standalone decision-making tools, and then reference the Sok}Decision-making on changes that affect the L1 largely rely on social consensus. In contrast, L2s typically concentrate decision-making among core stakeholders. Often, this takes the form of centralized foundations that control protocol upgrades and sequencer operations. 
    % Some L2s decentralize decision-making using token-based governance. 
    Because based L2s maximally leverage L1 validators, there is a governance dependency where based L2s are subject to L1 governance decisions made by a broader, potentially misaligned set of stakeholders. 
    \todo{implications for preconfs?}
    \qb{in the context of preconfs, L2 governance is important: watchtowers, kicking proposers out of the permission set; L2 governance is far more flexible than at L1; governanc eis typically handled by a specific set of stakeholders rather than the social concensus at L1. Thsi enables faster decision making and more focused decisions around user welfare when it comes to preconfs; preconfs are much more possible at L2 than L1}

    

\end{document}

% TO-DO:
% Signify open questions
%   gateways
%   fair exchange
%   registry contract (restake, etc)
%   punishing conditions
%   performance monitoring for preconfers, gateways
%   enforcement mechanism
% add more figures
%   user-preconfer interaction figure


% -1    \part{part}
%  0	\chapter{chapter}
%  1	\section{section}
%  2	\subsection{subsection}
%  3	\subsubsection{subsubsection}
%  4	\paragraph{paragraph}
%  5	\subparagraph{subparagraph}

